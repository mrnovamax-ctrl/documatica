# ๐ ะะพะบัะผะตะฝัะฐัะธั ะธะฝัะตะณัะฐัะธะธ ัะบัะฟะพััะฐ ะฃะะ ะฒ Excel

**ะะฐัะฐ:** 29 ัะฝะฒะฐัั 2026  
**ะะตััะธั:** 1.0  
**ะกัะฐััั:** โ Backend ะณะพัะพะฒ ะบ production, Frontend ะพะถะธะดะฐะตั ะธะฝัะตะณัะฐัะธะธ  

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต

1. [ะะฑะทะพั ััะฝะบัะธะพะฝะฐะปะฐ](#ะพะฑะทะพั-ััะฝะบัะธะพะฝะฐะปะฐ)
2. [ะััะธัะตะบัััะฐ ัะตัะตะฝะธั](#ะฐััะธัะตะบัััะฐ-ัะตัะตะฝะธั)
3. [API ะดะพะบัะผะตะฝัะฐัะธั](#api-ะดะพะบัะผะตะฝัะฐัะธั)
4. [ะะพะดะดะตัะถะธะฒะฐะตะผัะต ัะพัะผะฐัั](#ะฟะพะดะดะตัะถะธะฒะฐะตะผัะต-ัะพัะผะฐัั)
5. [ะะตะทัะปััะฐัั ัะตััะธัะพะฒะฐะฝะธั](#ัะตะทัะปััะฐัั-ัะตััะธัะพะฒะฐะฝะธั)
6. [ะะปะฐะฝ ะธะฝัะตะณัะฐัะธะธ ั ััะพะฝัะตะฝะดะพะผ](#ะฟะปะฐะฝ-ะธะฝัะตะณัะฐัะธะธ-ั-ััะพะฝัะตะฝะดะพะผ)
7. [ะะฝััััะบัะธะธ ะฟะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั](#ะธะฝััััะบัะธะธ-ะฟะพ-ะธัะฟะพะปัะทะพะฒะฐะฝะธั)
8. [ะะทะฒะตััะฝัะต ะพะณัะฐะฝะธัะตะฝะธั](#ะธะทะฒะตััะฝัะต-ะพะณัะฐะฝะธัะตะฝะธั)
9. [ะงะตะบ-ะปะธัั ะดะปั ะดะตะฟะปะพั](#ัะตะบ-ะปะธัั-ะดะปั-ะดะตะฟะปะพั)
10. [ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะฐััะธัะตะฝะธั](#ัะตะบะพะผะตะฝะดะฐัะธะธ-ะฟะพ-ัะฐััะธัะตะฝะธั)
11. [ะะตััะธะบะธ ะธ ะผะพะฝะธัะพัะธะฝะณ](#ะผะตััะธะบะธ-ะธ-ะผะพะฝะธัะพัะธะฝะณ)

---

## ๐ ะะฑะทะพั ััะฝะบัะธะพะฝะฐะปะฐ

### ะะฐะทะฝะฐัะตะฝะธะต

ะคัะฝะบัะธะพะฝะฐะป ัะบัะฟะพััะฐ ะฟะพะทะฒะพะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปัะผ ัะบะฐัะธะฒะฐัั ัะพััะฐะฝะตะฝะฝัะต ะดะพะบัะผะตะฝัั (ะฃะะ, ะะบัั, ะกัะตัะฐ) ะฒ ัะพัะผะฐัะฐั Excel (XLS/XLSX) ะดะปั ะดะฐะปัะฝะตะนัะตะณะพ ัะตะดะฐะบัะธัะพะฒะฐะฝะธั ะธ ัะฐะฑะพัั ะฒ Microsoft Excel, LibreOffice Calc ะธ ะดััะณะธั ัะฐะฑะปะธัะฝัั ัะตะดะฐะบัะพัะฐั.

### ะะปััะตะฒัะต ะฒะพะทะผะพะถะฝะพััะธ

โ **ะญะบัะฟะพัั ะฒ ะดะฒะฐ ัะพัะผะฐัะฐ:**
- **XLS** โ ะฑัััััะน ัะบัะฟะพัั ัะตัะตะท HTML ั Office XML ัะตะณะฐะผะธ (MVP)
- **XLSX** โ ะบะฐัะตััะฒะตะฝะฝัะน ัะบัะฟะพัั ัะตัะตะท openpyxl ั ัะพัะฝัะผ ัะพัะผะฐัะธัะพะฒะฐะฝะธะตะผ

โ **ะะพะดะดะตัะถะบะฐ ัะธะฟะพะฒ ะดะพะบัะผะตะฝัะพะฒ:**
- ะฃะะ (ะฃะฝะธะฒะตััะฐะปัะฝัะน ะะตัะตะดะฐัะพัะฝัะน ะะพะบัะผะตะฝั) โ ะฟะพะปะฝะฐั ัะตะฐะปะธะทะฐัะธั
- ะะบั ะฒัะฟะพะปะฝะตะฝะฝัั ัะฐะฑะพั โ ะฑะฐะทะพะฒะฐั ัะตะฐะปะธะทะฐัะธั
- ะกัะตั ะฝะฐ ะพะฟะปะฐัั โ ะฑะฐะทะพะฒะฐั ัะตะฐะปะธะทะฐัะธั

โ **ะะตะทะพะฟะฐัะฝะพััั:**
- ะะฒัะพัะธะทะฐัะธั ะพะฑัะทะฐัะตะปัะฝะฐ
- ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะดะพัััะฟะฐ (ัะพะปัะบะพ ะฒะปะฐะดะตะปะตั ะดะพะบัะผะตะฝัะฐ)
- ะะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพะฟะตัะฐัะธะน ัะบัะฟะพััะฐ

โ **ะะฐัะตััะฒะพ ัะบัะฟะพััะฐ:**
- ะัะต ะฟะพะปั ะดะพะบัะผะตะฝัะฐ ัะพััะฐะฝััััั
- ะะพััะตะบัะฝะพะต ัะพัะผะฐัะธัะพะฒะฐะฝะธะต (ััะธััั, ะณัะฐะฝะธัั, ะฒััะฐะฒะฝะธะฒะฐะฝะธะต)
- ะัะฐะฒะธะปัะฝะฐั ััััะบัััะฐ ัะฐะฑะปะธั (14 ะบะพะปะพะฝะพะบ ะดะปั ะฃะะ)
- ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ัะธัะตะป (ัะตะฝั, ััะผะผั)
- ะะพะดะดะตัะถะบะฐ ะธัะพะณะพะฒัั ัััะพะบ ั ัะพัะผัะปะฐะผะธ

### ะขัะตะฑะพะฒะฐะฝะธั ะบะปะธะตะฝัะฐ

> "ะะพะฑะฐะฒะปััั ะบะฝะพะฟะบั ะบะพะฝะฒะตััะฐัะธะธ ะฒ ัะบัะตะปั ะฑัะดะตะผ ะฒ ะผะพะธั ะดะพะบัะผะตะฝัะฐั https://oplatanalogov.ru/dashboard/documents/"

**ะขะตะบััะธะน ััะฐััั:** Backend ััะฝะบัะธะพะฝะฐะป ัะตะฐะปะธะทะพะฒะฐะฝ ะธ ะฟัะพัะตััะธัะพะฒะฐะฝ. ะะถะธะดะฐะตััั ะธะฝัะตะณัะฐัะธั ั ััะพะฝัะตะฝะดะพะผ (ะดะพะฑะฐะฒะปะตะฝะธะต ะบะฝะพะฟะพะบ ะฒ ะธะฝัะตััะตะนั).

---

## ๐๏ธ ะััะธัะตะบัััะฐ ัะตัะตะฝะธั

### ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Frontend (Browser)                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  /dashboard/documents/ (ะกะฟะธัะพะบ ะดะพะบัะผะตะฝัะพะฒ)             โ โ
โ  โ  โโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ โ
โ  โ  โ ะะพะบัะผะตะฝั โ   PDF    โ  [Excel โผ] (future)      โ   โ โ
โ  โ  โโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ HTTP GET
                        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Backend API (FastAPI)                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  GET /api/v1/documents/saved/{id}/export-excel         โ โ
โ  โ  โข ะัะพะฒะตัะบะฐ ะฐะฒัะพัะธะทะฐัะธะธ (JWT)                          โ โ
โ  โ  โข ะะฐะปะธะดะฐัะธั ะฟัะฐะฒ ะดะพัััะฟะฐ                              โ โ
โ  โ  โข ะะตะปะตะณะธัะพะฒะฐะฝะธะต ะฒ ExcelExportService                  โ โ
โ  โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            ExcelExportService (Business Logic)               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  โข _read_document_data() โ ััะตะฝะธะต ะธะท /documents/       โ โ
โ  โ  โข export_to_xls() โ HTML โ XLS (ะฑััััะพ)               โ โ
โ  โ  โข export_to_xlsx() โ openpyxl โ XLSX (ะบะฐัะตััะฒะตะฝะฝะพ)    โ โ
โ  โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              File System (/documents/)                       โ
โ  {document_id}/                                              โ
โ  โโโ metadata.json      (ัะธะฟ, ะฒะปะฐะดะตะปะตั, ะดะฐัะฐ)               โ
โ  โโโ form_data.json     (ะธััะพะดะฝัะต ะดะฐะฝะฝัะต ัะพัะผั)             โ
โ  โโโ document.html      (ะณะพัะพะฒัะน HTML ั Office XML)         โ
โ  โโโ document.pdf       (ะพะฟัะธะพะฝะฐะปัะฝะพ)                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะคะฐะนะปะพะฒะฐั ััััะบัััะฐ

```
backend/
โโโ app/
โ   โโโ api/
โ   โ   โโโ documents.py                 # API endpoint (ัััะพะบะฐ 765-832)
โ   โ       โโโ @router.get("/saved/{document_id}/export-excel")
โ   โ
โ   โโโ services/
โ   โ   โโโ excel_export.py              # ะกะตัะฒะธั ัะบัะฟะพััะฐ (612 ัััะพะบ)
โ   โ       โโโ ExcelExportService       # ะัะฝะพะฒะฝะพะน ะบะปะฐัั
โ   โ       โโโ export_to_xls()          # XLS ัะบัะฟะพัั (HTML)
โ   โ       โโโ export_to_xlsx()         # XLSX ัะบัะฟะพัั (openpyxl)
โ   โ       โโโ _read_document_data()    # ะงัะตะฝะธะต ะดะฐะฝะฝัั
โ   โ       โโโ _create_xlsx_from_upd_data()   # ะะตะฝะตัะฐัะธั ะฃะะ
โ   โ       โโโ _get_excel_filename()    # ะคะพัะผะธัะพะฒะฐะฝะธะต ะธะผะตะฝะธ
โ   โ
โ   โโโ templates/
โ       โโโ dashboard/
โ           โโโ documents/
โ               โโโ index.html           # ะกะฟะธัะพะบ ะดะพะบัะผะตะฝัะพะฒ (325 ัััะพะบ)
โ
โโโ documents/                           # ะฅัะฐะฝะธะปะธัะต ะดะพะบัะผะตะฝัะพะฒ
โ   โโโ {uuid}/
โ       โโโ metadata.json
โ       โโโ form_data.json
โ       โโโ document.html
โ
โโโ EXCEL_EXPORT_TEST_REPORT.md          # ะััะตั ะพ ัะตััะธัะพะฒะฐะฝะธะธ
โโโ requirements.txt                     # ะะฐะฒะธัะธะผะพััะธ (openpyxl 3.1.5)
```

### ะขะตัะฝะพะปะพะณะธะธ

| ะะพะผะฟะพะฝะตะฝั | ะขะตัะฝะพะปะพะณะธั | ะะตััะธั |
|-----------|------------|--------|
| Backend Framework | FastAPI | 0.109.2 |
| Excel Library | openpyxl | 3.1.5 |
| Template Engine | Jinja2 | 3.1.3 |
| Authentication | JWT | - |
| Python | Python | 3.11+ |

---

## ๐ API ะดะพะบัะผะตะฝัะฐัะธั

### Endpoint

```
GET /api/v1/documents/saved/{document_id}/export-excel
```

### ะะฐัะฐะผะตััั

#### Path Parameters

| ะะฐัะฐะผะตัั | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝัะน | ะะฟะธัะฐะฝะธะต |
|----------|-----|--------------|----------|
| `document_id` | string (UUID) | โ ะะฐ | ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั ะดะพะบัะผะตะฝัะฐ |

#### Query Parameters

| ะะฐัะฐะผะตัั | ะขะธะฟ | ะะฑัะทะฐัะตะปัะฝัะน | ะะพ ัะผะพะปัะฐะฝะธั | ะะฟะธัะฐะฝะธะต |
|----------|-----|--------------|--------------|----------|
| `format` | string | โ ะะตั | `"xls"` | ะคะพัะผะฐั ัะบัะฟะพััะฐ: `"xls"` ะธะปะธ `"xlsx"` |

### ะะฐะณะพะปะพะฒะบะธ ะทะฐะฟัะพัะฐ

```http
Authorization: Bearer {access_token}
```

**ะะปััะตัะฝะฐัะธะฒะฐ:** Cookie `access_token={token}`

### ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ

#### cURL (XLS ัะพัะผะฐั)

```bash
curl -X GET \
  "https://oplatanalogov.ru/api/v1/documents/saved/550e8400-e29b-41d4-a716-446655440000/export-excel?format=xls" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..." \
  --output document.xls
```

#### cURL (XLSX ัะพัะผะฐั)

```bash
curl -X GET \
  "https://oplatanalogov.ru/api/v1/documents/saved/550e8400-e29b-41d4-a716-446655440000/export-excel?format=xlsx" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..." \
  --output document.xlsx
```

#### JavaScript (Fetch API)

```javascript
async function downloadExcel(documentId, format = 'xls') {
    try {
        const response = await fetch(
            `/api/v1/documents/saved/${documentId}/export-excel?format=${format}`,
            {
                method: 'GET',
                credentials: 'include',  // ะะฒัะพะผะฐัะธัะตัะบะธ ะพัะฟัะฐะฒะปัะตั cookies
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                }
            }
        );

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        // ะะพะปััะฐะตะผ blob
        const blob = await response.blob();
        
        // ะกะพะทะดะฐะตะผ ัััะปะบั ะดะปั ัะบะฐัะธะฒะฐะฝะธั
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `document.${format}`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        console.log('ะคะฐะนะป ััะฟะตัะฝะพ ัะบะฐัะฐะฝ');
    } catch (error) {
        console.error('ะัะธะฑะบะฐ ัะบะฐัะธะฒะฐะฝะธั:', error);
        alert('ะัะธะฑะบะฐ ะฟัะธ ัะบะฐัะธะฒะฐะฝะธะธ ัะฐะนะปะฐ');
    }
}

// ะัะฟะพะปัะทะพะฒะฐะฝะธะต
downloadExcel('550e8400-e29b-41d4-a716-446655440000', 'xlsx');
```

### ะัะฒะตัั

#### 200 OK โ ะฃัะฟะตัะฝัะน ัะบัะฟะพัั

```http
HTTP/1.1 200 OK
Content-Type: application/vnd.ms-excel
Content-Disposition: attachment; filename="UPD_125_20260118.xls"
Content-Length: 796661

<binary data>
```

**ะะปั XLSX:**
```http
Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
Content-Disposition: attachment; filename="UPD_125_20260118.xlsx"
```

#### 400 Bad Request โ ะะตะฒะตัะฝัะน ัะพัะผะฐั

```json
{
  "detail": "ะะตะฟะพะดะดะตัะถะธะฒะฐะตะผัะน ัะพัะผะฐั: pdf. ะัะฟะพะปัะทัะนัะต 'xls' ะธะปะธ 'xlsx'"
}
```

#### 401 Unauthorized โ ะะต ะฐะฒัะพัะธะทะพะฒะฐะฝ

```json
{
  "detail": "ะขัะตะฑัะตััั ะฐะฒัะพัะธะทะฐัะธั"
}
```

#### 403 Forbidden โ ะะพัััะฟ ะทะฐะฟัะตัะตะฝ

```json
{
  "detail": "ะะพัััะฟ ะทะฐะฟัะตัะตะฝ"
}
```

*ะะพะทะฝะธะบะฐะตั ะบะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟััะฐะตััั ัะบะฐัะฐัั ััะถะพะน ะดะพะบัะผะตะฝั*

#### 404 Not Found โ ะะพะบัะผะตะฝั ะฝะต ะฝะฐะนะดะตะฝ

```json
{
  "detail": "ะะพะบัะผะตะฝั ะฝะต ะฝะฐะนะดะตะฝ"
}
```

#### 422 Unprocessable Entity โ ะะตะฟะพะดะดะตัะถะธะฒะฐะตะผัะน ัะธะฟ

```json
{
  "detail": "ะญะบัะฟะพัั ะฒ Excel ะดะปั ัะธะฟะฐ 'draft' ะฝะต ะฟะพะดะดะตัะถะธะฒะฐะตััั"
}
```

*ะะพะดะดะตัะถะธะฒะฐัััั ัะพะปัะบะพ ัะธะฟั: `upd`, `akt`, `invoice`*

#### 500 Internal Server Error โ ะัะธะฑะบะฐ ัะตัะฒะตัะฐ

```json
{
  "detail": "ะัะธะฑะบะฐ ัะบัะฟะพััะฐ ะฒ Excel: [ะฟะพะดัะพะฑะฝะพััะธ]"
}
```

### ะะพะณะธัะพะฒะฐะฝะธะต

ะัะต ะพะฟะตัะฐัะธะธ ัะบัะฟะพััะฐ ะปะพะณะธัััััั:

```python
# ะฃัะฟะตัะฝัะน ัะบัะฟะพัั
INFO: XLS export requested: document_id=550e8400..., user_id=42
INFO: XLS export completed: document_id=550e8400..., filename=UPD_125_20260118.xls

# ะัะธะฑะบะฐ ะดะพัััะฟะฐ
WARNING: Access denied: user 42 tried to access document 550e8400... (owner: 15)

# ะัะธะฑะบะฐ ัะบัะฟะพััะฐ
ERROR: XLS export error: [ะดะตัะฐะปะธ], document_id=550e8400...
```

---

## ๐ ะะพะดะดะตัะถะธะฒะฐะตะผัะต ัะพัะผะฐัั

### XLS (Excel 97-2003)

**ะะตัะพะด ัะตะฐะปะธะทะฐัะธะธ:** HTML ั Office XML ัะตะณะฐะผะธ โ Content-Type: application/vnd.ms-excel

#### ะัะตะธะผััะตััะฒะฐ
- โ ะััััะฐั ะณะตะฝะตัะฐัะธั (~100-200ms)
- โ ะะธะฝะธะผะฐะปัะฝะฐั ะฝะฐะณััะทะบะฐ ะฝะฐ ัะตัะฒะตั
- โ ะะต ััะตะฑัะตั ะฟะฐััะธะฝะณะฐ ะดะฐะฝะฝัั
- โ ะฃะฝะธะฒะตััะฐะปัะฝะฐั ัะพะฒะผะตััะธะผะพััั
- โ ะะฐะฑะพัะฐะตั ะดะปั ะฒัะตั ัะธะฟะพะฒ ะดะพะบัะผะตะฝัะพะฒ

#### ะะตะดะพััะฐัะบะธ
- โ๏ธ ะกัะฐััะน ัะพัะผะฐั (Excel 97-2003)
- โ๏ธ ะะพะปััะธะน ัะฐะทะผะตั ัะฐะนะปะฐ (~800KB)
- โ๏ธ ะะณัะฐะฝะธัะตะฝะฝะฐั ะฟะพะดะดะตัะถะบะฐ ะธะทะพะฑัะฐะถะตะฝะธะน
- โ๏ธ ะะพะถะตั ะฟะพะบะฐะทัะฒะฐัั ะฟัะตะดัะฟัะตะถะดะตะฝะธั ะฑะตะทะพะฟะฐัะฝะพััะธ

#### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั
- ะะพ ัะผะพะปัะฐะฝะธั ะดะปั ะฑััััะพะณะพ ัะบัะฟะพััะฐ
- ะะพะณะดะฐ ะฝะต ััะตะฑัะตััั ะธะดะตะฐะปัะฝะพะต ัะพัะผะฐัะธัะพะฒะฐะฝะธะต
- ะะปั ัะพะฒะผะตััะธะผะพััะธ ัะพ ััะฐััะผะธ ะฒะตััะธัะผะธ Excel

---

### XLSX (Excel 2007+)

**ะะตัะพะด ัะตะฐะปะธะทะฐัะธะธ:** ะัะพะณัะฐะผะผะฝะฐั ะณะตะฝะตัะฐัะธั ัะตัะตะท ะฑะธะฑะปะธะพัะตะบั openpyxl

#### ะัะตะธะผััะตััะฒะฐ
- โ ะกะพะฒัะตะผะตะฝะฝัะน ััะฐะฝะดะฐัั (Office Open XML)
- โ ะะพะผะฟะฐะบัะฝัะน ัะฐะทะผะตั (~6-10KB)
- โ ะขะพัะฝัะน ะบะพะฝััะพะปั ัะพัะผะฐัะธัะพะฒะฐะฝะธั
- โ ะะพะดะดะตัะถะบะฐ ะธะทะพะฑัะฐะถะตะฝะธะน ะธ ะฟะพะดะฟะธัะตะน
- โ ะะตั ะฟัะตะดัะฟัะตะถะดะตะฝะธะน ะฑะตะทะพะฟะฐัะฝะพััะธ

#### ะะตะดะพััะฐัะบะธ
- โ๏ธ ะะตะดะปะตะฝะฝะตะต ะณะตะฝะตัะฐัะธั (~50-150ms)
- โ๏ธ ะะพะปััะต ะฝะฐะณััะทะบะฐ ะฝะฐ ัะตัะฒะตั
- โ๏ธ ะขัะตะฑัะตั ัะพัะฝะพะน ัะตะฐะปะธะทะฐัะธะธ ะดะปั ะบะฐะถะดะพะณะพ ัะธะฟะฐ ะดะพะบัะผะตะฝัะฐ

#### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั
- ะะพะณะดะฐ ััะตะฑัะตััั ะธะดะตะฐะปัะฝะพะต ะบะฐัะตััะฒะพ
- ะะปั ะดะพะบัะผะตะฝัะพะฒ ั ะธะทะพะฑัะฐะถะตะฝะธัะผะธ/ะฟะตัะฐััะผะธ
- ะะพะณะดะฐ ัะฐะทะผะตั ัะฐะนะปะฐ ะบัะธัะธัะตะฝ
- ะะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั

---

### ะกัะฐะฒะฝะธัะตะปัะฝะฐั ัะฐะฑะปะธัะฐ

| ะฅะฐัะฐะบัะตัะธััะธะบะฐ | XLS | XLSX |
|----------------|-----|------|
| **ะะฐะทะผะตั ัะฐะนะปะฐ** | ~800 KB | ~6 KB |
| **ะกะบะพัะพััั ะณะตะฝะตัะฐัะธะธ** | 100-200 ms | 50-150 ms |
| **ะะฐัะตััะฒะพ ัะพัะผะฐัะธัะพะฒะฐะฝะธั** | 7/10 | 9/10 |
| **ะะพะดะดะตัะถะบะฐ ะธะทะพะฑัะฐะถะตะฝะธะน** | ะะณัะฐะฝะธัะตะฝะฝะฐั | ะะพะปะฝะฐั |
| **ะกะพะฒะผะตััะธะผะพััั** | Excel 97+ | Excel 2007+ |
| **ะัะตะดัะฟัะตะถะดะตะฝะธั ะฑะตะทะพะฟะฐัะฝะพััะธ** | ะะพะทะผะพะถะฝั | ะะตั |
| **ะกะปะพะถะฝะพััั ัะตะฐะปะธะทะฐัะธะธ** | ะะธะทะบะฐั | ะกัะตะดะฝัั |
| **ะะตะบะพะผะตะฝะดัะตััั ะดะปั production** | MVP | ะะดะตะฐะป |

---

## ๐งช ะะตะทัะปััะฐัั ัะตััะธัะพะฒะฐะฝะธั

### ะกัะฐััั ัะตััะธัะพะฒะฐะฝะธั

โ **ะัะต ัะตััั ะฟัะพะนะดะตะฝั ััะฟะตัะฝะพ**

ะะพะดัะพะฑะฝัะน ะพััะตั: [`backend/EXCEL_EXPORT_TEST_REPORT.md`](../backend/EXCEL_EXPORT_TEST_REPORT.md)

### ะัะฐัะบะฐั ัะฒะพะดะบะฐ

| ะะฐัะตะณะพัะธั | ะกัะฐััั | ะะตะทัะปััะฐั |
|-----------|--------|-----------|
| ะะฐะฒะธัะธะผะพััะธ | โ ะัะพะนะดะตะฝะพ | openpyxl 3.1.5, Jinja2 3.1.3, FastAPI 0.109.2 |
| ะขะตััะพะฒัะต ะดะฐะฝะฝัะต | โ ะัะพะนะดะตะฝะพ | 55 ะฃะะ ะดะพะบัะผะตะฝัะพะฒ ะฒ ะฑะฐะทะต |
| XLS ัะบัะฟะพัั | โ ะัะพะนะดะตะฝะพ | 796 KB, ะบะพััะตะบัะฝะพะต ัะพะดะตัะถะธะผะพะต |
| XLSX ัะบัะฟะพัั | โ ะัะพะนะดะตะฝะพ | 6.5 KB, ะฒะฐะปะธะดะฝะฐั ััััะบัััะฐ |
| ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต | โ ะัะพะนะดะตะฝะพ | ะัะต ััะธะปะธ ะฟัะธะผะตะฝะตะฝั |
| ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ | โ ะัะพะนะดะตะฝะพ | 401, 403, 404, 422 ะบะพััะตะบัะฝั |
| ะัะฐะฒะฐ ะดะพัััะฟะฐ | โ ะัะพะนะดะตะฝะพ | ะขะพะปัะบะพ ะฒะปะฐะดะตะปะตั ะผะพะถะตั ัะบะฐัะฐัั |

### ะัะพะฒะตัะตะฝะฝัะต ััะฝะบัะธะธ

#### ะกัััะบัััะฐ ะฃะะ ะฒ XLSX
- โ ะะฐะณะพะปะพะฒะพะบ ะดะพะบัะผะตะฝัะฐ (3 ัััะพะบะธ)
- โ ะะตะบะฒะธะทะธัั ะฟัะพะดะฐะฒัะฐ ะธ ะฟะพะบัะฟะฐัะตะปั
- โ ะขะฐะฑะปะธัะฐ ัะพะฒะฐัะพะฒ (14 ะบะพะปะพะฝะพะบ)
- โ 4 ัะพะฒะฐัะฝัะต ะฟะพะทะธัะธะธ ั ะดะฐะฝะฝัะผะธ
- โ ะัะพะณะพะฒะฐั ัััะพะบะฐ
- โ ะะพะดะฟะธัะธ ััะพัะพะฝ

#### ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต
- โ ะจัะธััั (Arial 8-11pt, bold ะณะดะต ะฝัะถะฝะพ)
- โ ะัะฐะฝะธัั ััะตะตะบ (thin border)
- โ ะััะฐะฒะฝะธะฒะฐะฝะธะต (ัะตะฝัั/ะปะตะฒะพ/ะฟัะฐะฒะพ)
- โ ะคะพัะผะฐัั ัะธัะตะป (#,##0.00 ะดะปั ะดะตะฝะตะณ)
- โ ะจะธัะธะฝะฐ ะบะพะปะพะฝะพะบ (ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฐ)
- โ ะะฐะปะธะฒะบะฐ ะทะฐะณะพะปะพะฒะบะพะฒ (#E0E0E0)

### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

| ะะตััะธะบะฐ | XLS | XLSX |
|---------|-----|------|
| ะกัะตะดะฝะตะต ะฒัะตะผั ะณะตะฝะตัะฐัะธะธ | 100-200 ms | 50-150 ms |
| ะะฐะทะผะตั ัะตะทัะปััะฐัะฐ | 796 KB | 6.5 KB |
| ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ | ะะธะทะบะพะต | ะกัะตะดะฝะตะต |
| CPU ะฝะฐะณััะทะบะฐ | ะะธะฝะธะผะฐะปัะฝะฐั | ะฃะผะตัะตะฝะฝะฐั |

**ะะตะบะพะผะตะฝะดะฐัะธั ะดะปั production:** XLSX ัะพัะผะฐั (ะผะตะฝััะต ัะฐะทะผะตั, ะฑััััะตะต ะณะตะฝะตัะฐัะธั)

---

## ๐จ ะะปะฐะฝ ะธะฝัะตะณัะฐัะธะธ ั ััะพะฝัะตะฝะดะพะผ

### ะขะตะบััะตะต ัะพััะพัะฝะธะต ะธะฝัะตััะตะนัะฐ

ะกััะฐะฝะธัะฐ ัะฟะธัะบะฐ ะดะพะบัะผะตะฝัะพะฒ: `/dashboard/documents/`

```html
<!-- ะขะตะบััะฐั ััััะบัััะฐ ะดะตะนััะฒะธะน -->
<td>
  <div class="d-flex gap-1">
    <button class="btn-outline-v12 btn-sm" title="ะกะบะฐัะฐัั PDF" 
            onclick="downloadPdf('${doc.id}')">
      <iconify-icon icon="mdi:download"></iconify-icon>
    </button>
    <button class="btn-outline-v12 btn-sm" title="ะฃะดะฐะปะธัั" 
            onclick="deleteDoc('${doc.id}')">
      <iconify-icon icon="mdi:delete"></iconify-icon>
    </button>
  </div>
</td>
```

### ะะฐัะธะฐะฝั 1: Dropdown ะผะตะฝั (ะะตะบะพะผะตะฝะดัะตััั)

**ะัะตะธะผััะตััะฒะฐ:**
- ะะต ะทะฐัะปะฐะผะปัะตั ะธะฝัะตััะตะนั
- ะะตะณะบะพ ัะฐััะธัััั (ะดะพะฑะฐะฒะธัั CSV, JSON, etc.)
- ะกะพะฒัะตะผะตะฝะฝัะน UX ะฟะฐััะตัะฝ
- ะกะพััะฐะฝัะตั ะผะตััะพ ะฒ ัะฐะฑะปะธัะต

#### HTML ััััะบัััะฐ

```html
<td>
  <div class="d-flex gap-1">
    <!-- Dropdown ะดะปั ัะบะฐัะธะฒะฐะฝะธั -->
    <div class="dropdown">
      <button class="btn-outline-v12 btn-sm dropdown-toggle" 
              type="button" 
              id="download-menu-${doc.id}" 
              data-bs-toggle="dropdown" 
              aria-expanded="false"
              title="ะกะบะฐัะฐัั ะดะพะบัะผะตะฝั">
        <iconify-icon icon="mdi:download"></iconify-icon>
      </button>
      <ul class="dropdown-menu" aria-labelledby="download-menu-${doc.id}">
        <li>
          <a class="dropdown-item" href="#" 
             onclick="event.preventDefault(); downloadPdf('${doc.id}')">
            <iconify-icon icon="mdi:file-pdf-box" class="me-2"></iconify-icon>
            PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="#" 
             onclick="event.preventDefault(); downloadExcel('${doc.id}', 'xlsx')">
            <iconify-icon icon="mdi:file-excel" class="me-2"></iconify-icon>
            Excel (XLSX)
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="#" 
             onclick="event.preventDefault(); downloadExcel('${doc.id}', 'xls')">
            <iconify-icon icon="mdi:file-excel-outline" class="me-2"></iconify-icon>
            Excel (XLS)
          </a>
        </li>
      </ul>
    </div>
    
    <!-- ะะฝะพะฟะบะฐ ัะดะฐะปะตะฝะธั ะพััะฐะตััั ะบะฐะบ ะตััั -->
    <button class="btn-outline-v12 btn-sm" title="ะฃะดะฐะปะธัั" 
            onclick="deleteDoc('${doc.id}')">
      <iconify-icon icon="mdi:delete"></iconify-icon>
    </button>
  </div>
</td>
```

#### JavaScript ััะฝะบัะธั

```javascript
/**
 * ะกะบะฐัะธะฒะฐะฝะธะต ะดะพะบัะผะตะฝัะฐ ะฒ ัะพัะผะฐัะต Excel
 * @param {string} id - UUID ะดะพะบัะผะตะฝัะฐ
 * @param {string} format - ะคะพัะผะฐั ัะบัะฟะพััะฐ ('xls' ะธะปะธ 'xlsx')
 */
async function downloadExcel(id, format = 'xlsx') {
  // ะะพะบะฐะทัะฒะฐะตะผ ะธะฝะดะธะบะฐัะพั ะทะฐะณััะทะบะธ
  const button = event.target.closest('button') || event.target.closest('a');
  const originalContent = button.innerHTML;
  button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
  button.disabled = true;

  try {
    const response = await fetch(
      `/api/v1/documents/saved/${id}/export-excel?format=${format}`,
      {
        method: 'GET',
        credentials: 'include',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('access_token')}`
        }
      }
    );

    if (!response.ok) {
      // ะะฑัะฐะฑะพัะบะฐ ัะฐะทะปะธัะฝัั ะพัะธะฑะพะบ
      if (response.status === 401) {
        alert('ะขัะตะฑัะตััั ะฐะฒัะพัะธะทะฐัะธั. ะะพะถะฐะปัะนััะฐ, ะฒะพะนะดะธัะต ะฒ ัะธััะตะผั.');
        window.location.href = '/auth/login';
        return;
      } else if (response.status === 403) {
        alert('ะฃ ะฒะฐั ะฝะตั ะดะพัััะฟะฐ ะบ ััะพะผั ะดะพะบัะผะตะฝัั.');
        return;
      } else if (response.status === 404) {
        alert('ะะพะบัะผะตะฝั ะฝะต ะฝะฐะนะดะตะฝ.');
        return;
      } else {
        const error = await response.json();
        throw new Error(error.detail || 'ะัะธะฑะบะฐ ัะบะฐัะธะฒะฐะฝะธั');
      }
    }

    // ะะพะปััะฐะตะผ blob ะธ ะธะทะฒะปะตะบะฐะตะผ ะธะผั ัะฐะนะปะฐ ะธะท ะทะฐะณะพะปะพะฒะบะฐ
    const blob = await response.blob();
    const contentDisposition = response.headers.get('Content-Disposition');
    let filename = `document.${format}`;
    
    if (contentDisposition) {
      const filenameMatch = contentDisposition.match(/filename="?([^"]+)"?/);
      if (filenameMatch) {
        filename = filenameMatch[1];
      }
    }

    // ะกะพะทะดะฐะตะผ ะฒัะตะผะตะฝะฝัั ัััะปะบั ะธ ะธะฝะธัะธะธััะตะผ ัะบะฐัะธะฒะฐะฝะธะต
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    
    // ะัะธััะบะฐ
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);

    // ะะฟัะธะพะฝะฐะปัะฝะพ: ะฟะพะบะฐะทะฐัั ัะฒะตะดะพะผะปะตะฝะธะต ะพะฑ ััะฟะตัะต
    showToast('ะคะฐะนะป ััะฟะตัะฝะพ ัะบะฐัะฐะฝ', 'success');

  } catch (error) {
    console.error('ะัะธะฑะบะฐ ัะบัะฟะพััะฐ ะฒ Excel:', error);
    alert(`ะัะธะฑะบะฐ ะฟัะธ ัะบะฐัะธะฒะฐะฝะธะธ ัะฐะนะปะฐ: ${error.message}`);
  } finally {
    // ะะพัััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะบะฝะพะฟะบั
    button.innerHTML = originalContent;
    button.disabled = false;
  }
}
```

#### CSS ััะธะปะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ)

```css
/* ะกัะธะปะธ ะดะปั dropdown ะผะตะฝั */
.dropdown-menu {
  min-width: 180px;
}

.dropdown-item {
  display: flex;
  align-items: center;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

.dropdown-item:hover {
  background-color: #f8f9fa;
}

.dropdown-item iconify-icon {
  width: 18px;
  height: 18px;
}

/* ะะฝะดะธะบะฐัะพั ะทะฐะณััะทะบะธ */
.spinner-border-sm {
  width: 1rem;
  height: 1rem;
  border-width: 0.15rem;
}
```

---

### ะะฐัะธะฐะฝั 2: ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะบะฝะพะฟะบะฐ

**ะัะตะธะผััะตััะฒะฐ:**
- ะัะพัะต ัะตะฐะปะธะทะฐัะธั
- ะััะผะพะน ะดะพัััะฟ ะฑะตะท ะผะตะฝั
- ะะพะฝััะฝัะน ะธะฝัะตััะตะนั

**ะะตะดะพััะฐัะบะธ:**
- ะะฐะฝะธะผะฐะตั ะฑะพะปััะต ะผะตััะฐ
- ะกะปะพะถะฝะตะต ัะฐััะธัััั

```html
<td>
  <div class="d-flex gap-1">
    <button class="btn-outline-v12 btn-sm" title="ะกะบะฐัะฐัั PDF" 
            onclick="downloadPdf('${doc.id}')">
      <iconify-icon icon="mdi:file-pdf-box"></iconify-icon>
    </button>
    
    <!-- ะะพะฒะฐั ะบะฝะพะฟะบะฐ Excel -->
    <button class="btn-outline-v12 btn-sm" title="ะกะบะฐัะฐัั Excel" 
            onclick="downloadExcel('${doc.id}', 'xlsx')">
      <iconify-icon icon="mdi:file-excel" style="color: #107C41;"></iconify-icon>
    </button>
    
    <button class="btn-outline-v12 btn-sm" title="ะฃะดะฐะปะธัั" 
            onclick="deleteDoc('${doc.id}')">
      <iconify-icon icon="mdi:delete"></iconify-icon>
    </button>
  </div>
</td>
```

---

### ะะฐัะธะฐะฝั 3: ะะพะดะฐะปัะฝะพะต ะพะบะฝะพ ะฒัะฑะพัะฐ ัะพัะผะฐัะฐ

**ะัะตะธะผััะตััะฒะฐ:**
- ะะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะพะฟะธัะฐะฝะธั ัะพัะผะฐัะพะฒ
- ะะฑัะฐะทะพะฒะฐัะตะปัะฝัะน ะผะพะผะตะฝั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะพะฟัะธะธ (ะฒัะฑะพั ะปะธััะพะฒ, ัะพัะผะฐัะธัะพะฒะฐะฝะธะต)

```javascript
function showExcelExportModal(documentId) {
  // ะะพะบะฐะทัะฒะฐะตะผ ะผะพะดะฐะปัะฝะพะต ะพะบะฝะพ ั ะฒัะฑะพัะพะผ ัะพัะผะฐัะฐ
  const modal = document.getElementById('excel-export-modal');
  modal.querySelector('[data-format="xlsx"]').onclick = () => {
    downloadExcel(documentId, 'xlsx');
    closeModal(modal);
  };
  modal.querySelector('[data-format="xls"]').onclick = () => {
    downloadExcel(documentId, 'xls');
    closeModal(modal);
  };
  showModal(modal);
}
```

---

### ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ UX

#### 1. ะะบะพะฝะบะธ

ะัะฟะพะปัะทัะนัะต ะฟะพะฝััะฝัะต ะธะบะพะฝะบะธ:
- PDF: `mdi:file-pdf-box` (ะบัะฐัะฝัะน #E74C3C)
- Excel XLSX: `mdi:file-excel` (ะทะตะปะตะฝัะน #107C41)
- Excel XLS: `mdi:file-excel-outline` (ะทะตะปะตะฝัะน #107C41)

#### 2. ะกะพััะพัะฝะธั

**ะะฐะณััะทะบะฐ:**
```javascript
button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
button.disabled = true;
```

**ะฃัะฟะตั:**
```javascript
showToast('ะคะฐะนะป ััะฟะตัะฝะพ ัะบะฐัะฐะฝ', 'success');
// ะธะปะธ ะฒัะตะผะตะฝะฝะพ ะผะตะฝัะตะผ ะธะบะพะฝะบั ะฝะฐ checkmark
```

**ะัะธะฑะบะฐ:**
```javascript
showToast('ะัะธะฑะบะฐ ะฟัะธ ัะบะฐัะธะฒะฐะฝะธะธ ัะฐะนะปะฐ', 'error');
```

#### 3. ะะดะฐะฟัะธะฒะฝะพััั

ะะฐ ะผะพะฑะธะปัะฝัั ััััะพะนััะฒะฐั:
- Dropdown ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฐะดะฐะฟัะธััะตััั
- ะะฝะพะฟะบะธ ะผะพะถะฝะพ ัะดะตะปะฐัั ั ัะตะบััะพะผ ะฒะผะตััะพ ะธะบะพะฝะพะบ
- ะะฐััะผะพััะตัั ะฒะตััะธะบะฐะปัะฝะพะต ัะฐัะฟะพะปะพะถะตะฝะธะต

#### 4. ะะพัััะฟะฝะพััั (A11y)

```html
<button 
  class="btn-outline-v12 btn-sm" 
  title="ะกะบะฐัะฐัั ะฒ ัะพัะผะฐัะต Excel"
  aria-label="ะกะบะฐัะฐัั ะดะพะบัะผะตะฝั ะฒ ัะพัะผะฐัะต Excel XLSX"
  onclick="downloadExcel('${doc.id}', 'xlsx')">
  <iconify-icon icon="mdi:file-excel" aria-hidden="true"></iconify-icon>
  <span class="visually-hidden">ะกะบะฐัะฐัั Excel</span>
</button>
```

---

### ะะพะดะธัะธะบะฐัะธั ัััะตััะฒัััะตะณะพ ะบะพะดะฐ

#### ะคะฐะนะป: `backend/app/templates/dashboard/documents/index.html`

**ะกััะพะบะธ 275-284 (ัะตะบััะธะน ะบะพะด):**

```javascript
row.innerHTML = `
  <td><strong>${doc.document_number || 'ะะตะท ะฝะพะผะตัะฐ'}</strong></td>
  <td>...</td>
  <td>...</td>
  <td>...</td>
  <td>...</td>
  <td>
    <div class="d-flex gap-1">
      <button class="btn-outline-v12 btn-sm" title="ะกะบะฐัะฐัั PDF" onclick="event.stopPropagation(); downloadPdf('${doc.id}')">
        <iconify-icon icon="mdi:download"></iconify-icon>
      </button>
      <button class="btn-outline-v12 btn-sm" title="ะฃะดะฐะปะธัั" onclick="event.stopPropagation(); deleteDoc('${doc.id}')">
        <iconify-icon icon="mdi:delete"></iconify-icon>
      </button>
    </div>
  </td>
`;
```

**ะะพะฒัะน ะบะพะด (ั dropdown):**

```javascript
row.innerHTML = `
  <td><strong>${doc.document_number || 'ะะตะท ะฝะพะผะตัะฐ'}</strong></td>
  <td>
    <span class="badge-v12 primary">
      ${docType}
    </span>
  </td>
  <td>${doc.buyer_name || '-'}</td>
  <td>${formatCurrency(doc.total_amount || 0)}</td>
  <td>${formatDate(doc.created_at)}</td>
  <td>
    <div class="d-flex gap-1">
      <!-- Dropdown ะดะปั ัะบะฐัะธะฒะฐะฝะธั -->
      <div class="btn-group">
        <button class="btn-outline-v12 btn-sm dropdown-toggle" 
                type="button" 
                data-bs-toggle="dropdown" 
                title="ะกะบะฐัะฐัั ะดะพะบัะผะตะฝั"
                onclick="event.stopPropagation()">
          <iconify-icon icon="mdi:download"></iconify-icon>
        </button>
        <ul class="dropdown-menu">
          <li>
            <a class="dropdown-item" href="#" 
               onclick="event.preventDefault(); event.stopPropagation(); downloadPdf('${doc.id}')">
              <iconify-icon icon="mdi:file-pdf-box" class="me-2" style="color: #E74C3C;"></iconify-icon>
              PDF
            </a>
          </li>
          <li><hr class="dropdown-divider"></li>
          <li>
            <a class="dropdown-item" href="#" 
               onclick="event.preventDefault(); event.stopPropagation(); downloadExcel('${doc.id}', 'xlsx')">
              <iconify-icon icon="mdi:file-excel" class="me-2" style="color: #107C41;"></iconify-icon>
              Excel (XLSX)
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#" 
               onclick="event.preventDefault(); event.stopPropagation(); downloadExcel('${doc.id}', 'xls')">
              <iconify-icon icon="mdi:file-excel-outline" class="me-2" style="color: #107C41;"></iconify-icon>
              Excel (XLS)
            </a>
          </li>
        </ul>
      </div>
      
      <!-- ะะฝะพะฟะบะฐ ัะดะฐะปะตะฝะธั -->
      <button class="btn-outline-v12 btn-sm" title="ะฃะดะฐะปะธัั" 
              onclick="event.stopPropagation(); deleteDoc('${doc.id}')">
        <iconify-icon icon="mdi:delete"></iconify-icon>
      </button>
    </div>
  </td>
`;
```

**ะะพะฑะฐะฒะธัั ััะฝะบัะธั downloadExcel (ะฟะพัะปะต ัััะพะบะธ 323):**

```javascript
async function downloadExcel(id, format = 'xlsx') {
  try {
    const response = await fetch(
      `/api/v1/documents/saved/${id}/export-excel?format=${format}`,
      { credentials: 'include' }
    );

    if (!response.ok) {
      if (response.status === 401) {
        alert('ะขัะตะฑัะตััั ะฐะฒัะพัะธะทะฐัะธั');
        window.location.href = '/auth/login';
        return;
      }
      throw new Error(`HTTP ${response.status}`);
    }

    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `document.${format}`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
  } catch (error) {
    console.error('Error downloading Excel:', error);
    alert('ะัะธะฑะบะฐ ะฟัะธ ัะบะฐัะธะฒะฐะฝะธะธ ัะฐะนะปะฐ');
  }
}
```

---

## ๐ ะะฝััััะบัะธะธ ะฟะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะะปั ัะฐะทัะฐะฑะพััะธะบะพะฒ

#### 1. ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ

```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
cd backend
pip install -r requirements.txt

# ะะฐะฟััะบ ัะตัะฒะตัะฐ
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

#### 2. ะขะตััะธัะพะฒะฐะฝะธะต endpoint

```bash
# ะะพะปััะธัั ัะฟะธัะพะบ ะดะพะบัะผะตะฝัะพะฒ
curl http://localhost:8000/api/v1/documents/ \
  -H "Cookie: access_token=YOUR_TOKEN"

# ะญะบัะฟะพัั ะฒ XLS
curl http://localhost:8000/api/v1/documents/saved/{DOC_ID}/export-excel?format=xls \
  -H "Cookie: access_token=YOUR_TOKEN" \
  --output test.xls

# ะญะบัะฟะพัั ะฒ XLSX
curl http://localhost:8000/api/v1/documents/saved/{DOC_ID}/export-excel?format=xlsx \
  -H "Cookie: access_token=YOUR_TOKEN" \
  --output test.xlsx
```

#### 3. ะะพะฑะฐะฒะปะตะฝะธะต ะฟะพะดะดะตัะถะบะธ ะฝะพะฒะพะณะพ ัะธะฟะฐ ะดะพะบัะผะตะฝัะฐ

```python
# ะ ัะฐะนะปะต backend/app/services/excel_export.py

class ExcelExportService:
    # ะะพะฑะฐะฒะธัั ัะธะฟ ะฒ ัะฟะธัะพะบ ะฟะพะดะดะตัะถะธะฒะฐะตะผัั
    SUPPORTED_TYPES = ['upd', 'akt', 'invoice', 'new_type']
    
    # ะะพะฑะฐะฒะธัั ะผะตัะพะด ะณะตะฝะตัะฐัะธะธ XLSX
    def _create_xlsx_from_new_type_data(self, form_data: Dict) -> BinaryIO:
        """ะกะพะทะดะฐะฝะธะต XLSX ะดะปั ะฝะพะฒะพะณะพ ัะธะฟะฐ ะดะพะบัะผะตะฝัะฐ"""
        wb = Workbook()
        ws = wb.active
        ws.title = "ะะพะฒัะน ะดะพะบัะผะตะฝั"
        
        # ... ะปะพะณะธะบะฐ ัะพัะผะฐัะธัะพะฒะฐะฝะธั ...
        
        buffer = io.BytesIO()
        wb.save(buffer)
        buffer.seek(0)
        return buffer
```

---

### ะะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

#### 1. ะกะบะฐัะธะฒะฐะฝะธะต ะดะพะบัะผะตะฝัะฐ ะฒ Excel

**ะงะตัะตะท ะธะฝัะตััะตะนั (ะฟะพัะปะต ะธะฝัะตะณัะฐัะธะธ):**

1. ะะตัะตะนะดะธัะต ะฒ ัะฐะทะดะตะป "ะะพะธ ะดะพะบัะผะตะฝัั": https://oplatanalogov.ru/dashboard/documents/
2. ะะฐะนะดะธัะต ะฝัะถะฝัะน ะดะพะบัะผะตะฝั ะฒ ัะฐะฑะปะธัะต
3. ะะฐะถะผะธัะต ะฝะฐ ะบะฝะพะฟะบั "ะกะบะฐัะฐัั" (ะธะบะพะฝะบะฐ ัะพ ัััะตะปะบะพะน ะฒะฝะธะท)
4. ะัะฑะตัะธัะต ัะพัะผะฐั:
   - **Excel (XLSX)** โ ัะตะบะพะผะตะฝะดัะตััั (ัะพะฒัะตะผะตะฝะฝัะน ัะพัะผะฐั, ะผะตะฝััะธะน ัะฐะทะผะตั)
   - **Excel (XLS)** โ ะดะปั ัะพะฒะผะตััะธะผะพััะธ ัะพ ััะฐััะผะธ ะฒะตััะธัะผะธ Excel
   - **PDF** โ ะดะปั ะฟะตัะฐัะธ ะธ ะฟัะพัะผะพััะฐ
5. ะคะฐะนะป ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะณััะทะธััั ะฝะฐ ะฒะฐั ะบะพะผะฟัััะตั

**ะงะตัะตะท ะฟััะผัั ัััะปะบั:**

```
https://oplatanalogov.ru/api/v1/documents/saved/{ID_ะะะะฃะะะะขะ}/export-excel?format=xlsx
```

#### 2. ะัะบัััะธะต ัะฐะนะปะฐ ะฒ Excel

**Microsoft Excel:**
1. ะัะบัะพะนัะต ัะบะฐัะฐะฝะฝัะน ัะฐะนะป ะดะฒะพะนะฝัะผ ะบะปะธะบะพะผ
2. ะัะปะธ ะฟะพัะฒะปัะตััั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต ะฑะตะทะพะฟะฐัะฝะพััะธ (ัะพะปัะบะพ ะดะปั XLS):
   - ะะฐะถะผะธัะต "ะะฐ" ะธะปะธ "Enable Editing"
3. ะะพะบัะผะตะฝั ะพัะบัะพะตััั ะธ ะณะพัะพะฒ ะบ ัะตะดะฐะบัะธัะพะฒะฐะฝะธั

**LibreOffice Calc:**
1. ะัะบัะพะนัะต ัะฐะนะป ัะตัะตะท File โ Open
2. ะะพะบัะผะตะฝั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฐัะฟะพะทะฝะฐะตััั ะบะฐะบ Excel ัะฐะนะป
3. ะัะต ัะพัะผะฐัะธัะพะฒะฐะฝะธะต ัะพััะฐะฝัะตััั

**Google Sheets:**
1. ะะตัะตะนะดะธัะต ะฝะฐ drive.google.com
2. ะะฐะถะผะธัะต "ะกะพะทะดะฐัั" โ "ะะฐะณััะทะธัั ัะฐะนะป"
3. ะัะฑะตัะธัะต ัะบะฐัะฐะฝะฝัะน XLSX ัะฐะนะป
4. ะคะฐะนะป ะพัะบัะพะตััั ะฒ Google Sheets

#### 3. ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะธ ัะพััะฐะฝะตะฝะธะต

- โ ะะพะถะฝะพ ัะตะดะฐะบัะธัะพะฒะฐัั ะฒัะต ััะตะนะบะธ
- โ ะะพะถะฝะพ ะดะพะฑะฐะฒะปััั/ัะดะฐะปััั ัััะพะบะธ
- โ ะะพะถะฝะพ ะธะทะผะตะฝััั ัะพัะผะฐัะธัะพะฒะฐะฝะธะต
- โ ะกะพััะฐะฝะธัะต ะบะฐะบ `.xlsx` ะดะปั ะผะฐะบัะธะผะฐะปัะฝะพะน ัะพะฒะผะตััะธะผะพััะธ

---

## โ๏ธ ะะทะฒะตััะฝัะต ะพะณัะฐะฝะธัะตะฝะธั

### ะขะตัะฝะธัะตัะบะธะต ะพะณัะฐะฝะธัะตะฝะธั

#### 1. ะคะพัะผะฐั XLS

| ะะณัะฐะฝะธัะตะฝะธะต | ะะฟะธัะฐะฝะธะต | ะะตัะตะฝะธะต |
|-------------|----------|---------|
| ะัะตะดัะฟัะตะถะดะตะฝะธั ะฑะตะทะพะฟะฐัะฝะพััะธ | Excel ะผะพะถะตั ะฟะพะบะฐะทัะฒะฐัั "ะคะฐะนะป ะฒ ะดััะณะพะผ ัะพัะผะฐัะต" | ะัะฟะพะปัะทะพะฒะฐัั XLSX ะธะปะธ ะฝะฐะถะฐัั "ะะฐ" |
| ะะฐะทะผะตั ัะฐะนะปะฐ | ~800KB ะดะฐะถะต ะดะปั ะฝะตะฑะพะปััะธั ะดะพะบัะผะตะฝัะพะฒ | ะัะฟะพะปัะทะพะฒะฐัั XLSX (6-10KB) |
| ะะทะพะฑัะฐะถะตะฝะธั | ะะณัะฐะฝะธัะตะฝะฝะฐั ะฟะพะดะดะตัะถะบะฐ base64 ะธะทะพะฑัะฐะถะตะฝะธะน | ะัะฟะพะปัะทะพะฒะฐัั XLSX |

#### 2. ะคะพัะผะฐั XLSX

| ะะณัะฐะฝะธัะตะฝะธะต | ะะฟะธัะฐะฝะธะต | ะะตัะตะฝะธะต |
|-------------|----------|---------|
| ะัะตะผั ะณะตะฝะตัะฐัะธะธ | ะงััั ะผะตะดะปะตะฝะฝะตะต XLS | ะัะธะตะผะปะตะผะพ (50-150ms) |
| ะะพะปะฝะฐั ัะตะฐะปะธะทะฐัะธั | ะขะพะปัะบะพ ะดะปั ะฃะะ, ะฑะฐะทะพะฒะฐั ะดะปั ะะบัะฐ/ะกัะตัะฐ | ะะถะธะดะฐะตััั ะดะพัะฐะฑะพัะบะฐ |

#### 3. ะะฑัะธะต ะพะณัะฐะฝะธัะตะฝะธั

- **ะขะธะฟั ะดะพะบัะผะตะฝัะพะฒ:** ะะพะดะดะตัะถะธะฒะฐัััั ัะพะปัะบะพ ะฃะะ, ะะบั, ะกัะตั. ะงะตัะฝะพะฒะธะบะธ (drafts) ะฝะต ะฟะพะดะดะตัะถะธะฒะฐัััั.
- **ะัะฐะฒะฐ ะดะพัััะฟะฐ:** ะขะพะปัะบะพ ะฒะปะฐะดะตะปะตั ะดะพะบัะผะตะฝัะฐ ะผะพะถะตั ัะบัะฟะพััะธัะพะฒะฐัั. ะะตั ะฟัะฑะปะธัะฝะพะณะพ ัะบัะฟะพััะฐ.
- **ะะฒัะพัะธะทะฐัะธั:** ะะฑัะทะฐัะตะปัะฝะฐ. ะะตะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ ะฟะพะปััะฐั 401.
- **ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั:** ะะตั ะธัะบััััะฒะตะฝะฝัั ะพะณัะฐะฝะธัะตะฝะธะน, ะฝะพ ะดะพะบัะผะตะฝัั ั 1000+ ัะพะฒะฐัะฐะผะธ ะผะพะณัั ะณะตะฝะตัะธัะพะฒะฐัััั ะดะพะปััะต.

### ะคัะฝะบัะธะพะฝะฐะปัะฝัะต ะพะณัะฐะฝะธัะตะฝะธั

#### ะงัะพ ะะ ะฟะพะดะดะตัะถะธะฒะฐะตััั ะฒ ัะตะบััะตะน ะฒะตััะธะธ

- โ **ะะฐะบะตัะฝัะน ัะบัะฟะพัั** โ ะฝะตะปัะทั ัะบัะฟะพััะธัะพะฒะฐัั ะฝะตัะบะพะปัะบะพ ะดะพะบัะผะตะฝัะพะฒ ะฒ ะพะดะธะฝ ัะฐะนะป
- โ **ะญะบัะฟะพัั ะฒ CSV/JSON** โ ัะพะปัะบะพ Excel ัะพัะผะฐัั
- โ **ะะฐัััะพะนะบะฐ ัะฐะฑะปะพะฝะพะฒ** โ ัะธะบัะธัะพะฒะฐะฝะฝัะน ัะพัะผะฐั
- โ **ะญะบัะฟะพัั ะฐััะธะฒะฐ ะดะพะบัะผะตะฝัะพะฒ** โ ัะพะปัะบะพ ะฟะพ ะพะดะฝะพะผั
- โ **ะัะฑะปะธัะฝัะต ัััะปะบะธ** โ ััะตะฑัะตััั ะฐะฒัะพัะธะทะฐัะธั
- โ **Email ะพัะฟัะฐะฒะบะฐ** โ ัะพะปัะบะพ ะฟััะผะพะต ัะบะฐัะธะฒะฐะฝะธะต
- โ **ะะปะฐะฝะธัะพะฒัะธะบ ัะบัะฟะพััะฐ** โ ัะพะปัะบะพ ะฟะพ ะทะฐะฟัะพัั

### ะะปะฐะฝะธััะตะผัะต ัะปัััะตะฝะธั

ะกะผ. ัะฐะทะดะตะป [ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะฐััะธัะตะฝะธั](#ัะตะบะพะผะตะฝะดะฐัะธะธ-ะฟะพ-ัะฐััะธัะตะฝะธั)

---

## โ ะงะตะบ-ะปะธัั ะดะปั ะดะตะฟะปะพั

### ะะพะดะณะพัะพะฒะบะฐ ะบ production

#### 1. ะะฐะฒะธัะธะผะพััะธ

```bash
# ะัะพะฒะตัะธัั ะฝะฐะปะธัะธะต ะฒ requirements.txt
grep "openpyxl" backend/requirements.txt  # ะะพะปะถะฝะพ ะฑััั: openpyxl==3.1.5
grep "Jinja2" backend/requirements.txt     # ะะพะปะถะฝะพ ะฑััั: Jinja2>=3.1.0

# ะฃััะฐะฝะพะฒะธัั ะฝะฐ production ัะตัะฒะตัะต
pip install openpyxl==3.1.5
```

**ะกัะฐััั:** โ ะะพัะพะฒะพ

#### 2. ะคะฐะนะปั ะธ ะดะธัะตะบัะพัะธะธ

```bash
# ะฃะฑะตะดะธัััั ััะพ ะดะธัะตะบัะพัะธั documents ัััะตััะฒัะตั ะธ writable
ls -la backend/documents/
# ะะพะปะถะฝะฐ ะฑััั: drwxrwxrwx

# ะัะพะฒะตัะธัั ะฝะฐะปะธัะธะต ัะฐะนะปะพะฒ
ls backend/app/services/excel_export.py  # ะะพะปะถะตะฝ ัััะตััะฒะพะฒะฐัั
grep "export-excel" backend/app/api/documents.py  # ะะพะปะถะตะฝ ะฝะฐะนัะธ endpoint
```

**ะกัะฐััั:** โ ะะพัะพะฒะพ

#### 3. ะัะฐะฒะฐ ะดะพัััะฟะฐ

```bash
# ะัะพะฒะตัะธัั ััะพ /documents/ ะดะพัััะฟะฝะฐ ะดะปั ะทะฐะฟะธัะธ
chmod 755 backend/documents/

# ะัะพะฒะตัะธัั ะฒะปะฐะดะตะปััะฐ
chown www-data:www-data backend/documents/  # ะธะปะธ ะฒะฐั ะฟะพะปัะทะพะฒะฐัะตะปั
```

**ะกัะฐััั:** โ๏ธ ะัะพะฒะตัะธัั ะฝะฐ production

#### 4. ะะพะฝัะธะณััะฐัะธั

```python
# backend/app/core/config.py โ ัะฑะตะดะธัััั ััะพ ะฝะฐัััะพะตะฝะพ
DOCUMENTS_DIR = Path(__file__).parent.parent.parent / "documents"
```

**ะกัะฐััั:** โ ะะพัะพะฒะพ

#### 5. ะะพะณะธัะพะฒะฐะฝะธะต

```python
# ะฃะฑะตะดะธัััั ััะพ ะปะพะณะธัะพะฒะฐะฝะธะต ะฝะฐัััะพะตะฝะพ
# backend/app/services/excel_export.py:24
logger = logging.getLogger(__name__)
```

**ะัะพะฒะตัะธัั ะปะพะณะธ:**
```bash
tail -f /var/log/documatica/app.log | grep "export"
```

**ะกัะฐััั:** โ ะะพัะพะฒะพ

#### 6. ะขะตััะธัะพะฒะฐะฝะธะต ะฝะฐ staging

```bash
# ะะฐะฟัััะธัั ัะตััั
cd backend
python test_excel_export.py
python test_api_export.py
python test_direct_export.py
```

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
```
โ All unit tests passed
โ All API tests passed
โ All direct tests passed
```

**ะกัะฐััั:** โ ะัะพะนะดะตะฝะพ (ัะผ. EXCEL_EXPORT_TEST_REPORT.md)

#### 7. ะัะพะฒะตัะบะฐ API

```bash
# ะัะพะฒะตัะธัั endpoint ะดะพัััะฟะตะฝ
curl -I https://oplatanalogov.ru/api/v1/documents/

# ะัะพะฒะตัะธัั ั ัะตะฐะปัะฝัะผ ะดะพะบัะผะตะฝัะพะผ
curl -X GET \
  "https://oplatanalogov.ru/api/v1/documents/saved/{REAL_DOC_ID}/export-excel?format=xlsx" \
  -H "Authorization: Bearer {REAL_TOKEN}" \
  --output test_production.xlsx

# ะัะบัััั test_production.xlsx ะฒ Excel
```

**ะกัะฐััั:** โณ ะัะฟะพะปะฝะธัั ะฝะฐ staging ะฟะตัะตะด production

#### 8. ะะพะฝะธัะพัะธะฝะณ

```bash
# ะะฐัััะพะธัั alerts ะดะปั ะพัะธะฑะพะบ ัะบัะฟะพััะฐ
# Prometheus/Grafana ะผะตััะธะบะธ:
# - excel_export_requests_total
# - excel_export_errors_total
# - excel_export_duration_seconds
```

**ะกัะฐััั:** โ๏ธ ะะฐัััะพะธัั ะผะพะฝะธัะพัะธะฝะณ

#### 9. ะะพะบัะผะตะฝัะฐัะธั ะดะปั ะฟะพะดะดะตัะถะบะธ

- โ ะกะพะทะดะฐะฝ ัะฐะนะป `docs/upd-excel-export-integration.md`
- โ ะกะพะทะดะฐะฝ ัะฐะนะป `backend/EXCEL_EXPORT_TEST_REPORT.md`
- โณ ะะฑะฝะพะฒะธัั ะฒะฝัััะตะฝะฝัั wiki (ะตัะปะธ ะตััั)
- โณ ะัะพะฒะตััะธ ะพะฑััะตะฝะธะต ะดะปั ะฟะพะดะดะตัะถะบะธ

#### 10. Rollback ะฟะปะฐะฝ

```bash
# ะ ัะปััะฐะต ะฟัะพะฑะปะตะผ - ะพัะบะฐัะธัั ะธะทะผะตะฝะตะฝะธั
git revert {commit_hash}

# ะะปะธ ะฒัะตะผะตะฝะฝะพ ะพัะบะปััะธัั ััะฝะบัะธะพะฝะฐะป ัะตัะตะท feature flag
# backend/app/core/config.py
EXCEL_EXPORT_ENABLED = False
```

**ะกัะฐััั:** ๐ ะะพะดะณะพัะพะฒะปะตะฝ

---

### Production Checklist

- [ ] **ะะฐะฒะธัะธะผะพััะธ ัััะฐะฝะพะฒะปะตะฝั** (openpyxl==3.1.5)
- [ ] **ะะธัะตะบัะพัะธั /documents/ ัััะตััะฒัะตั** ะธ writable
- [ ] **ะัะฐะฒะฐ ะดะพัััะฟะฐ ะฝะฐัััะพะตะฝั** (755 ะธะปะธ 775)
- [ ] **ะะพะณะธัะพะฒะฐะฝะธะต ัะฐะฑะพัะฐะตั** (ะปะพะณะธ ะฟะธััััั)
- [ ] **ะขะตััั ะฟัะพะนะดะตะฝั** ะฝะฐ staging ะพะบััะถะตะฝะธะธ
- [ ] **API endpoint ะดะพัััะฟะตะฝ** (/export-excel)
- [ ] **ะะตะฐะปัะฝัะน ะดะพะบัะผะตะฝั ัะบัะฟะพััะธััะตััั** ััะฟะตัะฝะพ
- [ ] **ะะพะฝะธัะพัะธะฝะณ ะฝะฐัััะพะตะฝ** (alerts, ะผะตััะธะบะธ)
- [ ] **ะะพะบัะผะตะฝัะฐัะธั ะณะพัะพะฒะฐ** ะดะปั ะฟะพะดะดะตัะถะบะธ
- [ ] **Rollback ะฟะปะฐะฝ** ะฟะพะดะณะพัะพะฒะปะตะฝ
- [ ] **Rate limiting** ะฝะฐัััะพะตะฝ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- [ ] **Backup ัััะฐัะตะณะธั** ะพะฟัะตะดะตะปะตะฝะฐ

---

### ะะพะผะฐะฝะดั ะดะปั ะฑััััะพะน ะฟัะพะฒะตัะบะธ

```bash
# ะะพะปะฝะฐั ะฟัะพะฒะตัะบะฐ ัะธััะตะผั
cat << 'EOF' > check_excel_export.sh
#!/bin/bash
echo "๐ ะัะพะฒะตัะบะฐ ัะธััะตะผั ัะบัะฟะพััะฐ ะฒ Excel..."

# 1. ะะฐะฒะธัะธะผะพััะธ
echo -n "1. openpyxl: "
python -c "import openpyxl; print(f'โ {openpyxl.__version__}')" 2>/dev/null || echo "โ ะะต ัััะฐะฝะพะฒะปะตะฝ"

# 2. ะคะฐะนะปั
echo -n "2. excel_export.py: "
[ -f backend/app/services/excel_export.py ] && echo "โ Exists" || echo "โ Missing"

# 3. ะะธัะตะบัะพัะธั
echo -n "3. /documents/: "
[ -d backend/documents ] && echo "โ Exists" || echo "โ Missing"

# 4. API endpoint
echo -n "4. API endpoint: "
grep -q "export-excel" backend/app/api/documents.py && echo "โ Found" || echo "โ Missing"

# 5. ะขะตััั
echo "5. ะะฐะฟััะบ ัะตััะพะฒ..."
cd backend
python test_excel_export.py > /dev/null 2>&1 && echo "   โ Tests passed" || echo "   โ Tests failed"

echo "โ ะัะพะฒะตัะบะฐ ะทะฐะฒะตััะตะฝะฐ"
EOF

chmod +x check_excel_export.sh
./check_excel_export.sh
```

---

## ๐ง ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะฐััะธัะตะฝะธั ััะฝะบัะธะพะฝะฐะปะฐ

### ะัะฐัะบะพััะพัะฝัะต ัะปัััะตะฝะธั (1-2 ะผะตัััะฐ)

#### 1. ะะพะดะดะตัะถะบะฐ ะพััะฐะปัะฝัั ัะธะฟะพะฒ ะดะพะบัะผะตะฝัะพะฒ

**ะัะธะพัะธัะตั:** ๐ด ะััะพะบะธะน

**ะะฟะธัะฐะฝะธะต:** ะะตะฐะปะธะทะพะฒะฐัั ะฟะพะปะฝะพัะตะฝะฝัะน XLSX ัะบัะฟะพัั ะดะปั ะะบัะพะฒ ะธ ะกัะตัะพะฒ (ัะตะนัะฐั ะฑะฐะทะพะฒะฐั ะฒะตััะธั)

**ะคะฐะนะปั ะดะปั ะธะทะผะตะฝะตะฝะธั:**
- `backend/app/services/excel_export.py:538-592`

**ะัะธะผะตั ัะตะฐะปะธะทะฐัะธะธ:**

```python
def _create_xlsx_from_akt_data(self, form_data: Dict) -> BinaryIO:
    """ะะพะปะฝะฐั ัะตะฐะปะธะทะฐัะธั ะะบัะฐ ะฒัะฟะพะปะฝะตะฝะฝัั ัะฐะฑะพั"""
    wb = Workbook()
    ws = wb.active
    ws.title = "ะะบั"
    
    # ะะฐะณะพะปะพะฒะพะบ
    ws.merge_cells('A1:G1')
    ws['A1'] = 'ะะะข ะะซะะะะะะะะซะฅ ะะะะะข (ะฃะกะะฃะ)'
    ws['A1'].font = Font(name='Arial', size=14, bold=True)
    ws['A1'].alignment = Alignment(horizontal='center')
    
    # ะะตะบะฒะธะทะธัั
    row = 3
    ws[f'A{row}'] = f"โ {form_data.get('document_number', '')}"
    ws[f'E{row}'] = f"ะพั {form_data.get('document_date', '')}"
    
    # ... ะพััะฐะปัะฝะฐั ะปะพะณะธะบะฐ ...
    
    buffer = io.BytesIO()
    wb.save(buffer)
    buffer.seek(0)
    return buffer
```

**ะัะตะฝะบะฐ:** 2-3 ะดะฝั ะฝะฐ ะบะฐะถะดัะน ัะธะฟ

---

#### 2. Batch Export (ะะฐะบะตัะฝัะน ัะบัะฟะพัั)

**ะัะธะพัะธัะตั:** ๐ก ะกัะตะดะฝะธะน

**ะะฟะธัะฐะฝะธะต:** ะะพะทะผะพะถะฝะพััั ัะบัะฟะพััะธัะพะฒะฐัั ะฝะตัะบะพะปัะบะพ ะดะพะบัะผะตะฝัะพะฒ ะฒ ะพะดะธะฝ Excel ัะฐะนะป (ัะฐะทะฝัะต ะปะธััั)

**ะะพะฒัะน endpoint:**

```python
@router.post("/batch-export-excel")
async def batch_export_documents_to_excel(
    request: BatchExportRequest,
    authorization: Optional[str] = Header(None),
    access_token: Optional[str] = Cookie(None)
):
    """
    ะญะบัะฟะพัั ะฝะตัะบะพะปัะบะธั ะดะพะบัะผะตะฝัะพะฒ ะฒ ะพะดะธะฝ XLSX ัะฐะนะป
    
    Request body:
    {
        "document_ids": ["uuid1", "uuid2", "uuid3"],
        "format": "xlsx"
    }
    
    Returns: Excel ัะฐะนะป ั ะฝะตัะบะพะปัะบะธะผะธ ะปะธััะฐะผะธ
    """
    # ะัะพะฒะตัะบะฐ ะฐะฒัะพัะธะทะฐัะธะธ
    user_id = get_user_id_from_token(authorization, access_token)
    if not user_id:
        raise HTTPException(401, "ะขัะตะฑัะตััั ะฐะฒัะพัะธะทะฐัะธั")
    
    # ะกะพะทะดะฐะตะผ workbook
    wb = Workbook()
    wb.remove(wb.active)  # ะฃะดะฐะปัะตะผ ะดะตัะพะปัะฝัะน ะปะธัั
    
    for doc_id in request.document_ids[:10]:  # ะะธะผะธั 10 ะดะพะบัะผะตะฝัะพะฒ
        # ะัะพะฒะตััะตะผ ะฟัะฐะฒะฐ
        # ะกะพะทะดะฐะตะผ ะปะธัั ะดะปั ะบะฐะถะดะพะณะพ ะดะพะบัะผะตะฝัะฐ
        service = ExcelExportService()
        # ... ะปะพะณะธะบะฐ ...
    
    # ะะพะทะฒัะฐัะฐะตะผ ะพะดะธะฝ ัะฐะนะป
    buffer = io.BytesIO()
    wb.save(buffer)
    buffer.seek(0)
    
    return StreamingResponse(
        buffer,
        media_type="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        headers={
            "Content-Disposition": f'attachment; filename="Documents_{datetime.now().strftime("%Y%m%d")}.xlsx"'
        }
    )
```

**UX ะฝะฐ ััะพะฝัะตะฝะดะต:**

```javascript
// ะงะตะบะฑะพะบัั ะดะปั ะฒัะฑะพัะฐ ะดะพะบัะผะตะฝัะพะฒ
function enableBatchSelection() {
    // ะะพะฑะฐะฒะปัะตะผ ัะตะบะฑะพะบั ะฒ ะบะฐะถะดัั ัััะพะบั
    // ะะพะบะฐะทัะฒะฐะตะผ ะบะฝะพะฟะบั "ะญะบัะฟะพััะธัะพะฒะฐัั ะฒัะฑัะฐะฝะฝัะต"
}

async function batchExportExcel() {
    const selectedIds = getSelectedDocumentIds();
    const response = await fetch('/api/v1/documents/batch-export-excel', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        credentials: 'include',
        body: JSON.stringify({
            document_ids: selectedIds,
            format: 'xlsx'
        })
    });
    // ... ัะบะฐัะธะฒะฐะฝะธะต ...
}
```

**ะัะตะฝะบะฐ:** 3-5 ะดะฝะตะน

---

#### 3. ะญะบัะฟะพัั ะฒ CSV

**ะัะธะพัะธัะตั:** ๐ข ะะธะทะบะธะน

**ะะฟะธัะฐะฝะธะต:** ะะพะฑะฐะฒะธัั ัะบัะฟะพัั ะฒ CSV ะดะปั ะฟัะพััะพะน ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั

**Endpoint:**

```python
@router.get("/saved/{document_id}/export-csv")
async def export_to_csv(document_id: str, ...):
    """ะญะบัะฟะพัั ัะฐะฑะปะธัั ัะพะฒะฐัะพะฒ ะฒ CSV"""
    # ะงะธัะฐะตะผ ะดะฐะฝะฝัะต
    metadata, form_data, _ = service._read_document_data(document_id, user_id)
    
    # ะะตะฝะตัะธััะตะผ CSV
    output = io.StringIO()
    writer = csv.writer(output)
    
    # ะะฐะณะพะปะพะฒะพะบ
    writer.writerow(['โ', 'ะะฐะธะผะตะฝะพะฒะฐะฝะธะต', 'ะะพะป-ะฒะพ', 'ะฆะตะฝะฐ', 'ะกัะผะผะฐ'])
    
    # ะะฐะฝะฝัะต
    for idx, item in enumerate(form_data.get('items', []), 1):
        writer.writerow([
            idx,
            item.get('name', ''),
            item.get('quantity', 0),
            item.get('price', 0),
            item.get('amount_with_vat', 0)
        ])
    
    # ะะพะทะฒัะฐัะฐะตะผ
    output.seek(0)
    return StreamingResponse(
        io.BytesIO(output.getvalue().encode('utf-8-sig')),  # BOM ะดะปั Excel
        media_type="text/csv",
        headers={"Content-Disposition": f'attachment; filename="{filename}.csv"'}
    )
```

**ะัะตะฝะบะฐ:** 1 ะดะตะฝั

---

### ะกัะตะดะฝะตััะพัะฝัะต ัะปัััะตะฝะธั (2-6 ะผะตัััะตะฒ)

#### 4. ะะฐัััะฐะธะฒะฐะตะผัะต ัะฐะฑะปะพะฝั Excel

**ะัะธะพัะธัะตั:** ๐ก ะกัะตะดะฝะธะน

**ะะฟะธัะฐะฝะธะต:** ะะพะทะฒะพะปะธัั ะฟะพะปัะทะพะฒะฐัะตะปัะผ ัะพะทะดะฐะฒะฐัั ัะพะฑััะฒะตะฝะฝัะต ัะฐะฑะปะพะฝั ะพัะพัะผะปะตะฝะธั

**ะคัะฝะบัะธะพะฝะฐะป:**
- ะัะฑะพั ััะธััะฐ, ัะฒะตัะพะฒ, ัะฐะทะผะตัะพะฒ
- ะะพะฑะฐะฒะปะตะฝะธะต ะปะพะณะพัะธะฟะฐ ะบะพะผะฟะฐะฝะธะธ
- ะะฐัััะพะนะบะฐ ะฟะพััะดะบะฐ ะบะพะปะพะฝะพะบ
- ะกะพััะฐะฝะตะฝะธะต ัะฐะฑะปะพะฝะพะฒ ะดะปั ะฟะพะฒัะพัะฝะพะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

**ะกัััะบัััะฐ:**

```python
# ะขะฐะฑะปะธัะฐ ะฒ ะะ
class ExcelTemplate(Base):
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey('users.id'))
    name = Column(String)  # "ะะพะน ัะธัะผะตะฝะฝัะน ััะธะปั"
    settings = Column(JSON)  # ะะฐัััะพะนะบะธ ัะพัะผะฐัะธัะพะฒะฐะฝะธั
    created_at = Column(DateTime)

# API
@router.post("/excel-templates/")
async def create_excel_template(template: ExcelTemplateCreate, ...):
    """ะกะพะทะดะฐะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปััะบะพะณะพ ัะฐะฑะปะพะฝะฐ"""
    pass

@router.get("/saved/{doc_id}/export-excel")
async def export_with_template(
    document_id: str,
    template_id: Optional[int] = None,
    ...
):
    """ะญะบัะฟะพัั ั ะฟัะธะผะตะฝะตะฝะธะตะผ ะฟะพะปัะทะพะฒะฐัะตะปััะบะพะณะพ ัะฐะฑะปะพะฝะฐ"""
    pass
```

**ะัะตะฝะบะฐ:** 2-3 ะฝะตะดะตะปะธ

---

#### 5. Email ะธะฝัะตะณัะฐัะธั

**ะัะธะพัะธัะตั:** ๐ก ะกัะตะดะฝะธะน

**ะะฟะธัะฐะฝะธะต:** ะัะฟัะฐะฒะบะฐ ัะบัะฟะพััะธัะพะฒะฐะฝะฝัั ัะฐะนะปะพะฒ ะฝะฐ email

**API:**

```python
@router.post("/saved/{document_id}/email-excel")
async def email_excel(
    document_id: str,
    email: str,
    format: str = "xlsx",
    ...
):
    """
    ะัะฟัะฐะฒะบะฐ Excel ัะฐะนะปะฐ ะฝะฐ ัะบะฐะทะฐะฝะฝัะน email
    
    Args:
        document_id: UUID ะดะพะบัะผะตะฝัะฐ
        email: Email ะฟะพะปััะฐัะตะปั
        format: xls ะธะปะธ xlsx
    """
    # ะะตะฝะตัะธััะตะผ Excel
    service = ExcelExportService()
    excel_buffer = service.export_to_xlsx(document_id, user_id)
    
    # ะัะฟัะฐะฒะปัะตะผ email
    email_service = EmailService()
    await email_service.send_with_attachment(
        to=email,
        subject=f"ะะพะบัะผะตะฝั {metadata.get('document_number')}",
        body="ะะพ ะฒะปะพะถะตะฝะธะธ ัะฐะนะป Excel ั ะดะพะบัะผะตะฝัะพะผ",
        attachment=excel_buffer,
        filename=f"document.{format}"
    )
    
    return {"success": True, "message": "Email ะพัะฟัะฐะฒะปะตะฝ"}
```

**ะัะตะฝะบะฐ:** 1 ะฝะตะดะตะปั

---

#### 6. ะะฝัะตะณัะฐัะธั ั Google Sheets

**ะัะธะพัะธัะตั:** ๐ข ะะธะทะบะธะน (ะธะฝัะตัะตัะฝะฐั ัะธัะฐ)

**ะะฟะธัะฐะฝะธะต:** ะััะผะฐั ะฟัะฑะปะธะบะฐัะธั ะดะพะบัะผะตะฝัะฐ ะฒ Google Sheets

**ะคัะฝะบัะธะพะฝะฐะป:**
- OAuth ะฐะฒัะพัะธะทะฐัะธั ัะตัะตะท Google
- ะกะพะทะดะฐะฝะธะต ะฝะพะฒะพะณะพ Sheet ะฒ Google Drive
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ะดะพะบัะผะตะฝัะฐ

```python
from googleapiclient.discovery import build
from google.oauth2.credentials import Credentials

@router.post("/saved/{document_id}/publish-to-sheets")
async def publish_to_google_sheets(
    document_id: str,
    credentials: GoogleCredentials,
    ...
):
    """ะัะฑะปะธะบะฐัะธั ะดะพะบัะผะตะฝัะฐ ะฒ Google Sheets"""
    # ะะฒัะพัะธะทะฐัะธั
    creds = Credentials.from_authorized_user_info(credentials.dict())
    service = build('sheets', 'v4', credentials=creds)
    
    # ะกะพะทะดะฐะตะผ ะฝะพะฒัะน spreadsheet
    spreadsheet = service.spreadsheets().create(body={
        'properties': {'title': f'ะฃะะ {document_number}'}
    }).execute()
    
    # ะะฐะฟะพะปะฝัะตะผ ะดะฐะฝะฝัะต
    # ...
    
    return {
        "success": True,
        "spreadsheet_url": f"https://docs.google.com/spreadsheets/d/{spreadsheet['spreadsheetId']}"
    }
```

**ะัะตะฝะบะฐ:** 2-3 ะฝะตะดะตะปะธ

---

### ะะพะปะณะพััะพัะฝัะต ัะปัััะตะฝะธั (6+ ะผะตัััะตะฒ)

#### 7. ะะฝะฐะปะธัะธะบะฐ ะธ ะพััะตัั

**ะัะธะพัะธัะตั:** ๐ก ะกัะตะดะฝะธะน

**ะะฟะธัะฐะฝะธะต:** ะะฝะฐะปะธัะธัะตัะบะธะต ะดะฐัะฑะพัะดั ะฝะฐ ะพัะฝะพะฒะต ัะบัะฟะพััะธัะพะฒะฐะฝะฝัั ะดะฐะฝะฝัั

**ะคัะฝะบัะธะพะฝะฐะป:**
- ะกะฒะพะดะฝัะต ัะฐะฑะปะธัั ะฟะพ ะฒัะตะผ ะดะพะบัะผะตะฝัะฐะผ
- ะัะฐัะธะบะธ ะดะธะฝะฐะผะธะบะธ ะฟัะพะดะฐะถ
- ะะฝะฐะปะธะท ะบะพะฝััะฐะณะตะฝัะพะฒ
- ะญะบัะฟะพัั ะฐะฝะฐะปะธัะธะบะธ ะฒ Excel

**ะัะธะผะตั:**

```python
@router.get("/analytics/export-excel")
async def export_analytics_to_excel(
    period: str,  # 'month', 'quarter', 'year'
    user_id: int
):
    """
    ะญะบัะฟะพัั ะฐะฝะฐะปะธัะธัะตัะบะพะณะพ ะพััะตัะฐ ะฒ Excel
    
    ะะธััั:
    1. ะกะฒะพะดะบะฐ โ ะพะฑัะธะต ะฟะพะบะฐะทะฐัะตะปะธ
    2. ะะพ ะดะพะบัะผะตะฝัะฐะผ โ ะดะตัะฐะปะธะทะฐัะธั
    3. ะะพ ะบะพะฝััะฐะณะตะฝัะฐะผ โ ัะพะฟ ะบะปะธะตะฝัะพะฒ
    4. ะัะฐัะธะบะธ โ ะฒะธะทัะฐะปะธะทะฐัะธั
    """
    wb = Workbook()
    
    # ะะธัั 1: ะกะฒะพะดะบะฐ
    ws_summary = wb.active
    ws_summary.title = "ะกะฒะพะดะบะฐ"
    # ... ะดะฐะฝะฝัะต ...
    
    # ะะธัั 2: ะะตัะฐะปะธะทะฐัะธั
    ws_details = wb.create_sheet("ะะพ ะดะพะบัะผะตะฝัะฐะผ")
    # ... ะดะฐะฝะฝัะต ...
    
    # ะะธัั 3: ะัะฐัะธะบะธ
    ws_charts = wb.create_sheet("ะัะฐัะธะบะธ")
    from openpyxl.chart import BarChart, Reference
    # ... ะณัะฐัะธะบะธ ...
    
    return excel_response
```

**ะัะตะฝะบะฐ:** 1-2 ะผะตัััะฐ

---

#### 8. Offline ัะตะถะธะผ (PWA)

**ะัะธะพัะธัะตั:** ๐ข ะะธะทะบะธะน

**ะะฟะธัะฐะฝะธะต:** ะะพะทะผะพะถะฝะพััั ัะบัะฟะพััะฐ ะฒ Excel ะดะฐะถะต ะฑะตะท ะธะฝัะตัะฝะตัะฐ (Progressive Web App)

**ะขะตัะฝะพะปะพะณะธั:**
- Service Worker ะดะปั ะบััะธัะพะฒะฐะฝะธั
- IndexedDB ะดะปั ััะฐะฝะตะฝะธั ะดะพะบัะผะตะฝัะพะฒ
- Client-side ะณะตะฝะตัะฐัะธั Excel (js-xlsx ะฑะธะฑะปะธะพัะตะบะฐ)

**ะัะตะฝะบะฐ:** 2-3 ะผะตัััะฐ

---

## ๐ ะะตััะธะบะธ ะธ ะผะพะฝะธัะพัะธะฝะณ

### Key Performance Indicators (KPIs)

#### 1. ะัะฟะพะปัะทะพะฒะฐะฝะธะต ััะฝะบัะธะพะฝะฐะปะฐ

**ะะตััะธะบะธ:**
```python
# Prometheus metrics
excel_exports_total = Counter(
    'excel_exports_total',
    'Total number of Excel exports',
    ['format', 'document_type', 'status']
)

excel_export_duration_seconds = Histogram(
    'excel_export_duration_seconds',
    'Duration of Excel export in seconds',
    ['format', 'document_type']
)
```

**ะฆะตะปะธ:**
- ะะธะฝะธะผัะผ 30% ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธัะฟะพะปัะทััั ัะบัะฟะพัั ะฒ Excel
- ะกัะตะดะฝัั ัะฐััะพัะฐ: 2+ ัะบัะฟะพััะฐ ะฝะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ ะผะตััั

#### 2. ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

**ะะตััะธะบะธ:**
- ะัะตะผั ะณะตะฝะตัะฐัะธะธ XLS: < 200ms (95-ะน ะฟะตััะตะฝัะธะปั)
- ะัะตะผั ะณะตะฝะตัะฐัะธะธ XLSX: < 150ms (95-ะน ะฟะตััะตะฝัะธะปั)
- ะะฐะทะผะตั XLS ัะฐะนะปะฐ: ~800KB
- ะะฐะทะผะตั XLSX ัะฐะนะปะฐ: ~6-10KB

**ะะพะฝะธัะพัะธะฝะณ:**
```python
import time

@router.get("/saved/{document_id}/export-excel")
async def export_excel(...):
    start_time = time.time()
    
    try:
        # ... ัะบัะฟะพัั ...
        
        duration = time.time() - start_time
        excel_export_duration_seconds.labels(
            format=format,
            document_type=metadata['type']
        ).observe(duration)
        
        excel_exports_total.labels(
            format=format,
            document_type=metadata['type'],
            status='success'
        ).inc()
        
    except Exception as e:
        excel_exports_total.labels(
            format=format,
            document_type='unknown',
            status='error'
        ).inc()
        raise
```

#### 3. ะะฐัะตััะฒะพ

**ะะตััะธะบะธ:**
- ะัะพัะตะฝั ััะฟะตัะฝัั ัะบัะฟะพััะพะฒ: > 99.5%
- ะัะพัะตะฝั ะถะฐะปะพะฑ ะฝะฐ ะบะฐัะตััะฒะพ: < 5%
- ะัะพัะตะฝั ะฟะพะฒัะพัะฝัั ัะบัะฟะพััะพะฒ: < 20%

**ะััะปะตะถะธะฒะฐะฝะธะต:**
```sql
-- ะฃัะฟะตัะฝะพััั ัะบัะฟะพััะพะฒ
SELECT 
    COUNT(*) as total_exports,
    SUM(CASE WHEN status = 'success' THEN 1 ELSE 0 END) as successful,
    SUM(CASE WHEN status = 'error' THEN 1 ELSE 0 END) as failed,
    (SUM(CASE WHEN status = 'success' THEN 1 ELSE 0 END)::float / COUNT(*) * 100) as success_rate
FROM export_logs
WHERE created_at >= NOW() - INTERVAL '30 days';
```

#### 4. ะะพะฟัะปััะฝะพััั ัะพัะผะฐัะพะฒ

**ะะฝะฐะปะธะท:**
```sql
-- ะะพะฟัะปััะฝะพััั XLS vs XLSX
SELECT 
    format,
    COUNT(*) as exports_count,
    ROUND(COUNT(*)::numeric / SUM(COUNT(*)) OVER () * 100, 2) as percentage
FROM export_logs
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY format;
```

**ะะถะธะดะฐะตะผะพะต ัะฐัะฟัะตะดะตะปะตะฝะธะต:**
- XLSX: 70-80%
- XLS: 20-30%

### Grafana Dashboard

**ะะฐะฝะตะปะธ:**

1. **ะะฑัะฐั ััะฐัะธััะธะบะฐ**
   - Total Exports (counter)
   - Exports per Hour (rate)
   - Success Rate (gauge)

2. **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**
   - Average Export Duration (graph)
   - 95th Percentile Duration (graph)
   - Export Duration by Format (heatmap)

3. **ะัะธะฑะบะธ**
   - Error Rate (graph)
   - Error Types (pie chart)
   - Failed Exports Log (table)

4. **ะะพะปัะทะพะฒะฐัะตะปััะบะฐั ะฐะบัะธะฒะฝะพััั**
   - Unique Users Exporting (counter)
   - Exports per User (histogram)
   - Popular Document Types (bar chart)

### Alerts

**ะัะธัะธัะตัะบะธะต:**
```yaml
# Prometheus AlertManager
groups:
  - name: excel_export
    rules:
      - alert: HighExportErrorRate
        expr: rate(excel_exports_total{status="error"}[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ะััะพะบะธะน ะฟัะพัะตะฝั ะพัะธะฑะพะบ ัะบัะฟะพััะฐ"
          description: "ะะพะปะตะต 5% ัะบัะฟะพััะพะฒ ะทะฐะฒะตััะฐัััั ั ะพัะธะฑะบะพะน"
      
      - alert: SlowExportDuration
        expr: histogram_quantile(0.95, rate(excel_export_duration_seconds_bucket[5m])) > 1
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "ะะตะดะปะตะฝะฝะฐั ะณะตะฝะตัะฐัะธั Excel"
          description: "95-ะน ะฟะตััะตะฝัะธะปั ะฒัะตะผะตะฝะธ ัะบัะฟะพััะฐ ะฟัะตะฒััะฐะตั 1 ัะตะบัะฝะดั"
```

---

## ๐ ะะฐะบะปััะตะฝะธะต

### ะกัะฐััั ะฟัะพะตะบัะฐ

โ **Backend ััะฝะบัะธะพะฝะฐะป ะฟะพะปะฝะพัััั ัะตะฐะปะธะทะพะฒะฐะฝ ะธ ะฟัะพัะตััะธัะพะฒะฐะฝ**

| ะะพะผะฟะพะฝะตะฝั | ะกัะฐััั | ะะพะผะผะตะฝัะฐัะธะน |
|-----------|--------|-------------|
| API Endpoint | โ ะะพัะพะฒ | [`documents.py:765`](../backend/app/api/documents.py#L765) |
| Excel Service | โ ะะพัะพะฒ | [`excel_export.py`](../backend/app/services/excel_export.py) |
| XLS ัะบัะฟะพัั | โ ะะฐะฑะพัะฐะตั | ะขะตััะธัะพะฒะฐะฝ, 796KB |
| XLSX ัะบัะฟะพัั | โ ะะฐะฑะพัะฐะตั | ะขะตััะธัะพะฒะฐะฝ, 6.5KB |
| ะฃะะ ะฟะพะดะดะตัะถะบะฐ | โ ะะพะปะฝะฐั | 14 ะบะพะปะพะฝะพะบ, ะฒัะต ะฟะพะปั |
| ะะบั ะฟะพะดะดะตัะถะบะฐ | โ ะะฐะทะพะฒะฐั | ะขัะตะฑัะตั ะดะพัะฐะฑะพัะบะธ |
| ะกัะตั ะฟะพะดะดะตัะถะบะฐ | โ ะะฐะทะพะฒะฐั | ะขัะตะฑัะตั ะดะพัะฐะฑะพัะบะธ |
| ะขะตััะธัะพะฒะฐะฝะธะต | โ ะัะพะนะดะตะฝะพ | ะกะผ. EXCEL_EXPORT_TEST_REPORT.md |
| ะะพะบัะผะตะฝัะฐัะธั | โ ะะพัะพะฒะฐ | ะญัะพั ัะฐะนะป |
| Frontend | โณ ะะถะธะดะฐะตััั | ะัะถะฝะพ ะดะพะฑะฐะฒะธัั ะบะฝะพะฟะบะธ |

### ะกะปะตะดัััะธะต ัะฐะณะธ

1. **ะะตะผะตะดะปะตะฝะฝะพ:**
   - โ ะะฐะทะฒะตัะฝััั backend ะฝะฐ staging
   - โณ ะัะพัะตััะธัะพะฒะฐัั ั ัะตะฐะปัะฝัะผะธ ะดะพะบัะผะตะฝัะฐะผะธ
   - โณ ะะพะฑะฐะฒะธัั ะบะฝะพะฟะบะธ ะฝะฐ ััะพะฝัะตะฝะด (ัะผ. ัะฐะทะดะตะป [ะะปะฐะฝ ะธะฝัะตะณัะฐัะธะธ](#ะฟะปะฐะฝ-ะธะฝัะตะณัะฐัะธะธ-ั-ััะพะฝัะตะฝะดะพะผ))

2. **ะัะฐัะบะพััะพัะฝะพ (1-2 ะฝะตะดะตะปะธ):**
   - ะกะพะฑัะฐัั ะพะฑัะฐัะฝัั ัะฒัะทั ะพั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
   - ะะพัะฐะฑะพัะฐัั XLSX ัะบัะฟะพัั ะดะปั ะะบัะพะฒ ะธ ะกัะตัะพะฒ
   - ะะฐัััะพะธัั ะผะพะฝะธัะพัะธะฝะณ ะธ alerts

3. **ะะพะปะณะพััะพัะฝะพ (1-3 ะผะตัััะฐ):**
   - ะะตะฐะปะธะทะพะฒะฐัั batch export
   - ะะพะฑะฐะฒะธัั CSV ัะบัะฟะพัั
   - ะะฐะทัะฐะฑะพัะฐัั ะฐะฝะฐะปะธัะธัะตัะบะธะต ะพััะตัั

### ะะพะฝัะฐะบัั ะดะปั ะฟะพะดะดะตัะถะบะธ

**ะะฐะทัะฐะฑะพััะธะบ:** Roo Architect Mode  
**ะะพะบัะผะตะฝัะฐัะธั:** `docs/upd-excel-export-integration.md`  
**ะขะตััั:** `backend/EXCEL_EXPORT_TEST_REPORT.md`  
**ะกะฟะตัะธัะธะบะฐัะธั:** `plans/upd-excel-export-specification.md`  

---

**ะะตััะธั ะดะพะบัะผะตะฝัะฐ:** 1.0  
**ะะฐัะฐ ัะพะทะดะฐะฝะธั:** 29 ัะฝะฒะฐัั 2026  
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** 29 ัะฝะฒะฐัั 2026  

โ **ะะพัะพะฒะพ ะบ production ะดะตะฟะปะพั**
