<!-- Main Navigation Header v12.1 (Dynamic) -->
{% set nav = get_navigation() %}

<header class="main-header" id="header">
  <div class="main-header__container">
    
    <!-- Logo -->
    <a href="/" class="main-header__logo">
      <svg class="main-header__logo-icon" viewBox="0 0 64 64" fill="none">
        <path d="M12 16H48V48H12V16Z" fill="#3b82f6" fill-opacity="0.1"/>
        <path d="M18 24H46M18 32H46M18 40H34" stroke="#3b82f6" stroke-width="6" stroke-linecap="round"/>
        <circle cx="48" cy="40" r="6" fill="#FBBF24"/>
      </svg>
      <span class="main-header__logo-text">
        <span class="main-header__logo-bold">docu</span><span class="main-header__logo-light">matica</span>
      </span>
    </a>
    
    <!-- Main Navigation -->
    <nav class="main-header__nav">
      
      <!-- Dropdown: Документы -->
      <div class="main-header__dropdown">
        <button class="main-header__dropdown-toggle" type="button">
          <span>Документы</span>
          <svg class="main-header__dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="main-header__mega-menu">
          <div class="mega-menu__inner">
            
            {% for section in nav.sections %}
            <div class="mega-menu__section">
              <div class="mega-menu__section-title">{{ section.title }}</div>
              {% for item in section.menu_items %}
              <a href="{{ item.url }}" class="mega-menu__item{% if item.featured %} mega-menu__item--featured{% endif %}{% if item.coming_soon %} mega-menu__item--disabled{% endif %}">
                <div class="mega-menu__item-icon{% if item.featured %} mega-menu__item-icon--blue{% endif %}">
                  {% set icon_svg = nav.icons[item.icon] | default('') %}
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">{{ icon_svg | safe }}</svg>
                </div>
                <div class="mega-menu__item-content">
                  <div class="mega-menu__item-title">{{ item.title }}</div>
                  {% if item.description %}
                  <div class="mega-menu__item-desc">{{ item.description }}</div>
                  {% endif %}
                </div>
                {% if item.badge %}
                <span class="mega-menu__badge">{{ item.badge }}</span>
                {% elif item.coming_soon %}
                <span class="mega-menu__badge mega-menu__badge--muted">Скоро</span>
                {% endif %}
              </a>
              {% endfor %}
            </div>
            {% endfor %}
            
            <!-- Promo блок -->
            <div class="mega-menu__promo">
              <div class="mega-menu__promo-card">
                <div class="mega-menu__promo-badge">Новое</div>
                <div class="mega-menu__promo-title">AI-помощник</div>
                <div class="mega-menu__promo-desc">Автозаполнение документов по ИНН, проверка данных</div>
                <a href="/dashboard/upd/create/" class="mega-menu__promo-btn">Попробовать</a>
              </div>
            </div>
            
          </div>
        </div>
      </div>
      
      <!-- Простые ссылки -->
      <a href="/#pricing" class="main-header__link">Тарифы</a>
      <a href="/news/" class="main-header__link">Новости</a>
      <a href="/about/" class="main-header__link">О нас</a>
      
    </nav>
    
    <!-- Right Side: Auth -->
    <div class="main-header__auth">
      <a href="/login/" class="main-header__btn main-header__btn--outline">Войти</a>
      <a href="/register/" class="main-header__btn main-header__btn--primary">Регистрация</a>
    </div>
    
    <!-- Mobile Toggle - SIMPLE WORKING VERSION -->
    <button id="mobileBurgerBtn" type="button" aria-label="Меню">
      <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    
  </div>
</header>

<!-- Mobile Menu Panel - OUTSIDE HEADER -->
<div id="mobileMenuPanel">
  <div id="mobileMenuOverlay"></div>
  <div id="mobileMenuContent">
    <button id="mobileMenuClose">&times;</button>
    
    {% for section in nav.sections %}
    <div class="mm-section">
      <div class="mm-section-title">{{ section.title }}</div>
      {% for item in section.menu_items %}
      <a href="{{ item.url }}" class="mm-link">{{ item.title }}</a>
      {% endfor %}
    </div>
    {% endfor %}
    
    <div class="mm-section">
      <a href="/#pricing" class="mm-link">Тарифы</a>
      <a href="/news/" class="mm-link">Новости</a>
      <a href="/about/" class="mm-link">О нас</a>
    </div>
    
    <div class="mm-auth">
      <a href="/login/" class="mm-btn mm-btn-outline">Войти</a>
      <a href="/register/" class="mm-btn mm-btn-primary">Регистрация</a>
    </div>
  </div>
</div>

<style>
/* Burger Button */
#mobileBurgerBtn {
  display: none;
  width: 44px;
  height: 44px;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  color: #64748b;
  padding: 0;
}
#mobileBurgerBtn:hover {
  background: #f1f5f9;
}

@media (max-width: 1024px) {
  #mobileBurgerBtn {
    display: flex !important;
  }
  .main-header__nav {
    display: none !important;
  }
  .main-header__auth {
    display: none !important;
  }
}

/* Mobile Menu Panel */
#mobileMenuPanel {
  display: none;
}
#mobileMenuPanel.open {
  display: block;
}

#mobileMenuOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 9998;
}

#mobileMenuContent {
  position: fixed;
  top: 0;
  right: 0;
  width: 320px;
  max-width: 85vw;
  height: 100%;
  background: white;
  z-index: 9999;
  padding: 20px;
  overflow-y: auto;
  box-shadow: -10px 0 30px rgba(0,0,0,0.2);
}

#mobileMenuClose {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 40px;
  height: 40px;
  border: none;
  background: #f1f5f9;
  border-radius: 8px;
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #64748b;
}
#mobileMenuClose:hover {
  background: #e2e8f0;
}

.mm-section {
  margin-bottom: 24px;
  padding-top: 20px;
}
.mm-section:first-child {
  padding-top: 50px;
}
.mm-section-title {
  font-size: 10px;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: #94a3b8;
  margin-bottom: 12px;
}
.mm-link {
  display: block;
  padding: 12px 0;
  color: #334155;
  text-decoration: none;
  font-weight: 500;
  font-size: 15px;
  border-bottom: 1px solid #f1f5f9;
}
.mm-link:hover {
  color: #3b82f6;
}

.mm-auth {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding-top: 24px;
  border-top: 1px solid #e2e8f0;
  margin-top: 24px;
}
.mm-btn {
  display: block;
  text-align: center;
  padding: 14px 20px;
  border-radius: 12px;
  font-weight: 600;
  text-decoration: none;
  font-size: 14px;
}
.mm-btn-outline {
  border: 2px solid #e2e8f0;
  color: #334155;
}
.mm-btn-primary {
  background: #3b82f6;
  color: white;
}
</style>

<script>
(function() {
  var burger = document.getElementById('mobileBurgerBtn');
  var panel = document.getElementById('mobileMenuPanel');
  var overlay = document.getElementById('mobileMenuOverlay');
  var closeBtn = document.getElementById('mobileMenuClose');
  
  function openMenu() {
    panel.classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  
  function closeMenu() {
    panel.classList.remove('open');
    document.body.style.overflow = '';
  }
  
  burger.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    openMenu();
  });
  
  overlay.addEventListener('click', closeMenu);
  closeBtn.addEventListener('click', closeMenu);
  
  // Close on resize to desktop
  window.addEventListener('resize', function() {
    if (window.innerWidth > 1024) {
      closeMenu();
    }
  });
})();

// Dropdown menu logic
document.querySelectorAll('.main-header__dropdown-toggle').forEach(function(toggle) {
  toggle.addEventListener('click', function(e) {
    e.preventDefault();
    var dropdown = toggle.closest('.main-header__dropdown');
    document.querySelectorAll('.main-header__dropdown').forEach(function(d) {
      if (d !== dropdown) d.classList.remove('is-open');
    });
    dropdown.classList.toggle('is-open');
  });
});

document.addEventListener('click', function(e) {
  if (!e.target.closest('.main-header__dropdown')) {
    document.querySelectorAll('.main-header__dropdown').forEach(function(d) {
      d.classList.remove('is-open');
    });
  }
});
</script>
