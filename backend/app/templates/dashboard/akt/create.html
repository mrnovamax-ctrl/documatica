<!DOCTYPE html>
<html lang="ru" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Создать Акт выполненных работ - Documatica</title>
  <link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg">
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <!-- remix icon font css -->
  <link rel="stylesheet" href="/static/css/remixicon.css">
  <!-- Iconify for v12 icons -->
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <!-- BootStrap css -->
  <link rel="stylesheet" href="/static/css/lib/bootstrap.min.css">
  <!-- Date picker css -->
  <link rel="stylesheet" href="/static/css/lib/flatpickr.min.css">
  <!-- html2canvas for preview -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- Documatica v12.0 Design System (ONLY v12, no old styles) -->
  <link rel="stylesheet" href="/static/css/documatica.css?v=12.9">
  <!-- UPD Constructor Styles (reuse for Akt) -->
  <link rel="stylesheet" href="/static/css/upd-constructor.css?v=2.1">
  
  <style>
    /* Анимация выезда кнопки "Добавить в контрагенты" */
    #save-customer-btn {
      opacity: 0;
      visibility: hidden;
    }
    #save-customer-btn.show {
      opacity: 1 !important;
      visibility: visible !important;
      transform: translateX(0) !important;
    }
    #save-customer-btn:hover {
      padding: 0 16px !important;
      box-shadow: 0 4px 16px rgba(251, 191, 36, 0.5) !important;
    }
    #save-customer-btn:hover span {
      opacity: 1 !important;
      width: auto !important;
    }
    #save-customer-btn:hover svg {
      transform: rotate(90deg) !important;
    }
    #save-customer-btn:active {
      transform: translateX(0) scale(0.95) !important;
    }
    
    /* Анимация выезда кнопки "Добавить в организации" */
    #save-executor-btn {
      opacity: 0;
      visibility: hidden;
    }
    #save-executor-btn.show {
      opacity: 1 !important;
      visibility: visible !important;
      transform: translateX(0) !important;
    }
    #save-executor-btn:hover {
      padding: 0 16px !important;
      box-shadow: 0 4px 16px rgba(251, 191, 36, 0.5) !important;
    }
    #save-executor-btn:hover span {
      opacity: 1 !important;
      width: auto !important;
    }
    #save-executor-btn:hover svg {
      transform: rotate(90deg) !important;
    }
    #save-executor-btn:active {
      transform: translateX(0) scale(0.95) !important;
    }
  </style>
</head>

<body class="constructor-page-v12">

<!-- Sidebar v12 -->
{% include 'components/sidebar_v12.html' %}

<!-- Sidebar Overlay for mobile -->
<div class="sidebar-overlay-v12" onclick="document.body.classList.remove('sidebar-open')"></div>

<!-- Mobile Burger Button -->
<button class="constructor-burger-btn" onclick="document.body.classList.toggle('sidebar-open')" style="position: fixed; top: 16px; right: 16px; z-index: 1001; width: 48px; height: 48px; background: white; border: 1px solid #e2e8f0; border-radius: 12px; display: none; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
  <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#64748b" stroke-width="2">
    <line x1="3" y1="6" x2="21" y2="6"></line>
    <line x1="3" y1="12" x2="21" y2="12"></line>
    <line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</button>
<style>
  @media (max-width: 1023px) {
    .constructor-burger-btn { display: flex !important; }
    .sidebar-v12 { transform: translateX(-100%); z-index: 1000; transition: transform 0.3s ease; }
    body.sidebar-open .sidebar-v12 { transform: translateX(0); }
    body.sidebar-open .sidebar-overlay-v12 { opacity: 1; visibility: visible; }
    .sidebar-overlay-v12 { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 999; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
  }
</style>

<main class="dashboard-main-v12">
  <!-- Header v12 -->
  {% include 'components/header_dashboard_v12.html' %}

  <div class="dashboard-content-v12 upd-constructor-page">
    <!-- Page Title -->
    <div class="page-title-v12">
      <h1>Создать Акт</h1>
      <p>Акт выполненных работ (оказанных услуг)</p>
    </div>

    <form id="akt-form">
      <div class="row gy-4">
        <!-- Left Column - Form -->
        <div class="col-xxl-7 col-xl-6">
          <!-- Document Info -->
          <div class="card radius-16 mb-24">
            <div class="card-header py-16 px-24 border-bottom">
              <h4 class="mb-0">Параметры документа</h4>
            </div>
            <div class="card-body p-24">
              <div class="row g-16" style="margin-bottom: 24px;">
                <!-- Номер и дата -->
                <div class="col-md-4">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Номер акта <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="akt-number" placeholder="Авто" required>
                    <button class="btn btn-outline-secondary-600" type="button" id="auto-number-btn" title="Автонумерация">
                      Авто
                    </button>
                  </div>
                </div>
                <div class="col-md-4">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Дата документа <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <input type="text" class="form-control date-picker" id="akt-date" placeholder="дд.мм.гггг" required>
                    <button class="btn btn-outline-secondary-600" type="button" id="akt-date-icon">
                      <iconify-icon icon="mdi:calendar"></iconify-icon>
                    </button>
                  </div>
                </div>
                <div class="col-md-4">
                  <!-- Пустая колонка для выравнивания -->
                </div>
                <!-- Договор -->
                <div class="col-md-6">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Номер договора</label>
                  <input type="text" class="form-control" id="contract-number" placeholder="Номер договора">
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Дата договора</label>
                  <div class="input-group">
                    <input type="text" class="form-control date-picker" id="contract-date" placeholder="дд.мм.гггг">
                    <button class="btn btn-outline-secondary-600" type="button" id="contract-date-icon">
                      <iconify-icon icon="mdi:calendar"></iconify-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Executor Info -->
          <div class="card radius-16 mb-24">
            <div class="card-header py-16 px-24 border-bottom d-flex align-items-center justify-content-between">
              <h4 class="mb-0">Исполнитель</h4>
              <button type="button" class="btn btn-sm btn-outline-primary-600" data-bs-toggle="modal" data-bs-target="#selectCompanyModal">
                Выбрать из списка
              </button>
            </div>
            <div class="card-body p-24">
              <div class="row g-16" style="margin-bottom: 24px;">
                <div class="col-md-6">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Наименование <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="executor-name" placeholder='ООО "Название"' required>
                </div>
                <div class="col-md-3">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">ИНН <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="executor-inn" placeholder="7707123456" required maxlength="12">
                    <button class="btn btn-outline-primary-600 dadata-search-btn" type="button" id="executor-inn-search" title="Найти по ИНН">
                      <iconify-icon icon="mdi:magnify" class="text-lg"></iconify-icon>
                    </button>
                  </div>
                  <small class="text-muted d-none" id="executor-inn-loading">Поиск...</small>
                </div>
                <div class="col-md-3">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">КПП</label>
                  <input type="text" class="form-control" id="executor-kpp" placeholder="770701001" maxlength="9">
                </div>
                <div class="col-12 d-none" id="executor-inn-error-container">
                  <div class="alert alert-danger py-2 px-3 mb-0" role="alert">
                    <small id="executor-inn-error"></small>
                  </div>
                </div>
                <div class="col-12" style="position: relative;">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Адрес</label>
                  <input type="text" class="form-control" id="executor-address" placeholder="123456, г. Москва, ул. Примерная, д. 1" style="padding-right: 50px;">
                  <!-- Кнопка добавить в организации внутри поля -->
                  <button type="button" id="save-executor-btn" title="Добавить в мои организации" style="position: absolute; right: 12px; bottom: 10px; background: #FBBF24; color: #0f172a; border: none; border-radius: 0.75rem; height: 36px; min-width: 36px; padding: 0 12px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s, visibility 0.3s; cursor: pointer; box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3); z-index: 10; transform: translateX(calc(100% + 24px)); white-space: nowrap; font-weight: 900; font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="flex-shrink: 0; transition: transform 0.3s;">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span style="opacity: 0; width: 0; overflow: hidden; transition: opacity 0.3s, width 0.3s;">Добавить в мои организации</span>
                  </button>
                </div>
              </div>
              
              <!-- Настройки НДС по умолчанию -->
              <div class="mt-24 pt-16 border-top">
                <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Настройки НДС (по умолчанию для услуг)</label>
                <div class="row g-16" style="margin-bottom: 24px;">
                  <div class="col-md-4">
                    <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Ставка НДС</label>
                    <select class="form-select" id="default-vat">
                      <option value="22">22%</option>
                      <option value="20" selected>20%</option>
                      <option value="18">18%</option>
                      <option value="10">10%</option>
                      <option value="7">7%</option>
                      <option value="5">5%</option>
                      <option value="0">0%</option>
                      <option value="none">Без НДС</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">НДС</label>
                    <select class="form-select" id="default-vat-type">
                      <option value="on-top" selected>Сверху</option>
                      <option value="included">Включен в цену</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Customer Info -->
          <div class="card radius-16 mb-24">
            <div class="card-header py-16 px-24 border-bottom d-flex align-items-center justify-content-between">
              <h4 class="mb-0">Заказчик</h4>
              <button type="button" class="btn btn-sm btn-outline-primary-600" data-bs-toggle="modal" data-bs-target="#selectContractorModal">
                Выбрать из списка
              </button>
            </div>
            <div class="card-body p-24">
              <div class="row g-16" style="margin-bottom: 24px;">
                <div class="col-md-6">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Наименование <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="customer-name" placeholder='ООО "Контрагент"' required>
                </div>
                <div class="col-md-3">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">ИНН <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="customer-inn" placeholder="7708654321" required maxlength="12">
                    <button class="btn btn-outline-primary-600 dadata-search-btn" type="button" id="customer-inn-search" title="Найти по ИНН">
                      <iconify-icon icon="mdi:magnify" class="text-lg"></iconify-icon>
                    </button>
                  </div>
                  <small class="text-muted d-none" id="customer-inn-loading">Поиск...</small>
                </div>
                <div class="col-md-3">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">КПП</label>
                  <input type="text" class="form-control" id="customer-kpp" placeholder="770801001" maxlength="9">
                </div>
                <div class="col-12 d-none" id="customer-inn-error-container">
                  <div class="alert alert-danger py-2 px-3 mb-0" role="alert">
                    <small id="customer-inn-error"></small>
                  </div>
                </div>
                <div class="col-12" style="position: relative;">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Адрес</label>
                  <input type="text" class="form-control" id="customer-address" placeholder="654321, г. Санкт-Петербург, пр. Невский, д. 100" style="padding-right: 50px;">
                  <!-- Кнопка добавить в клиенты внутри поля -->
                  <button type="button" id="save-customer-btn" title="Добавить в мои контрагенты" style="position: absolute; right: 12px; bottom: 10px; background: #FBBF24; color: #0f172a; border: none; border-radius: 0.75rem; height: 36px; min-width: 36px; padding: 0 12px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s, visibility 0.3s; cursor: pointer; box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3); z-index: 10; transform: translateX(calc(100% + 24px)); white-space: nowrap; font-weight: 900; font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="flex-shrink: 0; transition: transform 0.3s;">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span style="opacity: 0; width: 0; overflow: hidden; transition: opacity 0.3s, width 0.3s;">Добавить в мои контрагенты</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Works/Services -->
          <div class="card radius-16 mb-24">
            <div class="card-header py-16 px-24 border-bottom">
              <h4 class="mb-0">
                Работы и услуги
              </h4>
            </div>
            <div class="card-body p-24">
              <div id="products-container">
                <!-- Work Row 1 -->
                <div class="product-row card border radius-12 p-16 mb-16" data-row="1">
                  <div class="row g-12 align-items-end">
                    <div class="col">
                      <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Наименование <span class="text-danger">*</span></label>
                      <input type="text" class="form-control product-name" placeholder="Название работы или услуги" required>
                    </div>
                    <div class="col-auto" style="width: 100px;">
                      <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Кол-во</label>
                      <input type="number" class="form-control product-qty" value="1" min="0.01" step="0.01">
                    </div>
                    <div class="col-auto" style="width: 110px;">
                      <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Ед. изм.</label>
                      <select class="form-select product-unit">
                        <option value="усл" selected>усл</option>
                        <option value="шт">шт</option>
                        <option value="ч">ч</option>
                        <option value="кг">кг</option>
                        <option value="л">л</option>
                        <option value="м">м</option>
                        <option value="м2">м2</option>
                        <option value="м3">м3</option>
                      </select>
                    </div>
                    <div class="col-auto" style="width: 120px;">
                      <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Цена</label>
                      <input type="number" class="form-control product-price" value="0" min="0" step="0.01">
                    </div>
                    <div class="col-auto" style="width: 120px;">
                      <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Сумма</label>
                      <input type="text" class="form-control product-total" value="0 ₽" readonly>
                    </div>
                    <div class="col-auto">
                      <button type="button" class="btn btn-outline-danger remove-product" title="Удалить">
                        <iconify-icon icon="mdi:trash-can-outline"></iconify-icon>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Add Product Buttons -->
              <div class="d-flex mb-16" style="gap: 16px;">
                <button type="button" class="add-product-btn flex-grow-1 py-16 radius-12 d-flex align-items-center justify-content-center gap-8 text-secondary-light" id="add-product">
                  <iconify-icon icon="mdi:plus-circle" class="text-xl"></iconify-icon>
                  Добавить ещё
                </button>
                <button type="button" class="add-product-btn flex-grow-1 py-16 radius-12 d-flex align-items-center justify-content-center gap-8 text-secondary-light" data-bs-toggle="modal" data-bs-target="#selectProductModal">
                  <iconify-icon icon="mdi:package-variant" class="text-xl"></iconify-icon>
                  Выбрать из справочника
                </button>
              </div>

              <!-- Totals -->
              <div style="margin-top: 48px;">
                <div class="row justify-content-end">
                  <div class="col-md-6">
                    <div class="d-flex justify-content-between mb-16">
                      <span class="text-secondary-light">Итого без НДС:</span>
                      <span class="fw-medium" id="total-without-vat">0 ₽</span>
                    </div>
                    <div class="d-flex justify-content-between mb-16">
                      <span class="text-secondary-light">НДС:</span>
                      <span class="fw-medium" id="total-vat">0 ₽</span>
                    </div>
                    <div class="d-flex justify-content-between">
                      <span class="fw-semibold text-lg">Итого с НДС:</span>
                      <span class="fw-bold text-lg text-primary-600" id="total-with-vat">0 ₽</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Signatories -->
          <div class="card radius-16 mb-24">
            <div class="card-header py-16 px-24 border-bottom">
              <h4 class="mb-0">Подписанты</h4>
            </div>
            <div class="card-body p-24">
              <div class="row g-16" style="margin-bottom: 24px;">
                <!-- Исполнитель -->
                <div class="col-md-6">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">От исполнителя (ФИО)</label>
                  <input type="text" class="form-control" id="executor-signatory" placeholder="Иванов И.И.">
                </div>
                <!-- Заказчик -->
                <div class="col-md-6">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">От заказчика (ФИО)</label>
                  <input type="text" class="form-control" id="customer-signatory" placeholder="Петров П.П.">
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Info -->
          <div class="card radius-16 mb-24">
            <div class="card-header py-16 px-24 border-bottom">
              <h4 class="mb-0">Дополнительные сведения</h4>
            </div>
            <div class="card-body p-24">
              <div class="row g-16" style="margin-bottom: 24px;">
                <div class="col-12">
                  <label class="form-label fw-bold text-xs text-slate-600 text-uppercase" style="letter-spacing: 0.05em; margin-top: 16px; margin-bottom: 8px;">Примечания</label>
                  <textarea class="form-control" id="notes" rows="3" placeholder="Дополнительная информация"></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="card radius-16">
            <div class="card-body p-24">
              <div class="d-flex flex-wrap justify-content-center" style="gap: 16px;">
                <button type="button" class="btn btn-outline-primary-600 px-24" id="preview-btn" data-bs-toggle="modal" data-bs-target="#previewModal">
                  Предпросмотр
                </button>
                <button type="submit" class="btn btn-primary-600 px-32">
                  Скачать PDF
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column - Preview -->
        <div class="col-xxl-5 col-xl-6 d-none d-xl-block">
          <div class="sticky-preview">
            <div class="card radius-16">
              <div class="card-header py-16 px-24 border-bottom d-flex align-items-center justify-content-between">
                <h4 class="mb-0">Предпросмотр акта</h4>
                <div class="d-flex" style="gap: 8px;">
                  <button type="button" class="btn btn-sm btn-outline-primary-600" data-bs-toggle="modal" data-bs-target="#previewModal">
                    Предпросмотр
                  </button>
                </div>
              </div>
              <div class="card-body p-0 bg-white d-flex align-items-start justify-content-center position-relative" style="overflow: auto; background: #f8fafc;">
                <canvas id="sidebar-preview-canvas" style="width: 100%; height: auto;"></canvas>
                <!-- Лупа -->
                <div id="canvas-magnifier" style="display: none; position: absolute; width: 400px; height: 300px; border: 3px solid #3b82f6; border-radius: 12px; pointer-events: none; z-index: 1000; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.3); background: white;">
                  <canvas id="magnifier-canvas" width="1200" height="900" style="width: 100%; height: 100%; display: block;"></canvas>
                </div>
              </div>
            </div>
            
            <!-- AI Analysis Block -->
            <div class="card radius-16 mt-24">
              <div class="card-header py-16 px-24 d-flex align-items-center justify-content-between" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);">
                <div class="d-flex align-items-center" style="gap: 24px;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2">
                    <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"/>
                    <circle cx="7.5" cy="14.5" r="1.5"/>
                    <circle cx="16.5" cy="14.5" r="1.5"/>
                  </svg>
                  <span class="fw-bold text-uppercase" style="font-size: 18px; letter-spacing: 0.3em; color: #fbbf24; font-weight: 900;">ИИ Анализ документа</span>
                </div>
                <div class="d-flex align-items-center gap-8">
                  <button type="button" class="btn btn-sm d-none align-items-center gap-8" id="clear-highlights-btn" style="background: transparent; color: #94a3b8; border: 1px solid #475569; font-weight: 600; font-size: 10px; text-transform: uppercase;">
                    Сбросить подсветку
                  </button>
                  <button type="button" class="btn btn-sm d-flex align-items-center gap-8" id="ai-analyze-btn" style="background: #fbbf24; color: #0f172a; font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="11" cy="11" r="8"/>
                      <path d="m21 21-4.3-4.3"/>
                    </svg>
                    Анализировать
                  </button>
                </div>
              </div>
              <div class="card-body" id="ai-analysis-result" style="min-height: 100px;">
                <div class="text-center py-24 text-secondary-light">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="mb-12 mx-auto d-block" style="opacity: 0.5;">
                    <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 1 1 7.072 0l-.548.547A3.374 3.374 0 0 0 11 18.469V19a2 2 0 1 1-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                  <p class="mb-4 fw-semibold text-secondary-light">Нажмите "Анализировать" для проверки документа</p>
                  <small class="text-secondary-light">ИИ проверит документ на ошибки с точки зрения бухгалтера и юриста</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
  
</main>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
  <div class="modal-dialog" style="max-width: 98vw; width: 1200px; margin: 20px auto;">
    <div class="modal-content radius-16" style="overflow: hidden;">
      <div class="modal-header bg-neutral-50 py-12 px-24 border-bottom">
        <h5 class="modal-title">Предпросмотр акта</h5>
        <div class="d-flex gap-12 align-items-center">
          <button type="button" class="btn btn-sm btn-primary-600" id="modal-download-pdf">
            Скачать PDF
          </button>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
      </div>
      <div class="modal-body p-0 bg-white" style="overflow: hidden;">
        <iframe id="preview-iframe" style="width: 100%; height: 850px; border: none; display: block;" scrolling="no"></iframe>
      </div>
    </div>
  </div>
</div>

<!-- Select Company (Organization) Modal -->
<div class="modal fade" id="selectCompanyModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content radius-16">
      <div class="modal-header bg-neutral-50 py-16 px-24 border-bottom">
        <div>
          <h5 class="modal-title mb-1">Выберите организацию</h5>
          <p class="text-secondary-light text-sm mb-0">Нажмите на карточку для выбора</p>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-24">
        <div class="docu-mb-48">
          <input type="text" class="form-control" id="search-organization" placeholder="Поиск по названию или ИНН...">
        </div>
        <div id="organizations-modal-list" class="row g-3">
          <div class="col-12 text-center py-24 text-secondary-light">
            <iconify-icon icon="mdi:loading" class="spin text-2xl"></iconify-icon>
            <p class="mt-8">Загрузка организаций...</p>
          </div>
        </div>
        <div id="no-organizations-message" style="display: none;" class="text-center py-24">
          <iconify-icon icon="mdi:domain" class="text-secondary-light text-4xl"></iconify-icon>
          <p class="mt-8 text-secondary-light">Организации не найдены</p>
          <a href="/dashboard/organizations/create/" class="btn btn-sm btn-primary-600 mt-8">
            <iconify-icon icon="mdi:plus" class="me-1"></iconify-icon>
            Добавить организацию
          </a>
        </div>
      </div>
      <div class="modal-footer bg-neutral-50 border-top">
        <a href="/dashboard/organizations/create/" class="btn btn-outline-primary-600">
          <iconify-icon icon="mdi:plus" class="me-1"></iconify-icon>
          Добавить новую
        </a>
      </div>
    </div>
  </div>
</div>
<!-- Select Contractor Modal -->
<div class="modal fade" id="selectContractorModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content radius-16">
      <div class="modal-header bg-neutral-50 py-16 px-24 border-bottom">
        <div>
          <h5 class="modal-title mb-1">Выберите контрагента</h5>
          <p class="text-secondary-light text-sm mb-0">Нажмите на карточку для выбора</p>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-24">
        <div class="docu-mb-48">
          <input type="text" class="form-control" id="search-contractor" placeholder="Поиск по названию или ИНН...">
        </div>
        <div id="contractors-modal-list" class="row g-3">
          <div class="col-12 text-center py-24 text-secondary-light">
            <iconify-icon icon="mdi:loading" class="spin text-2xl"></iconify-icon>
            <p class="mt-8">Загрузка контрагентов...</p>
          </div>
        </div>
        <div id="no-contractors-message" style="display: none;" class="text-center py-24">
          <iconify-icon icon="mdi:account-group" class="text-secondary-light text-4xl"></iconify-icon>
          <p class="mt-8 text-secondary-light">Контрагенты не найдены</p>
          <a href="/dashboard/contractors/create/" class="btn btn-sm btn-primary-600 mt-8">
            <iconify-icon icon="mdi:plus" class="me-1"></iconify-icon>
            Добавить контрагента
          </a>
        </div>
      </div>
      <div class="modal-footer bg-neutral-50 border-top">
        <a href="/dashboard/contractors/create/" class="btn btn-outline-primary-600">
          <iconify-icon icon="mdi:plus" class="me-1"></iconify-icon>
          Добавить нового
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Select Product Modal -->
<div class="modal fade" id="selectProductModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content radius-16">
      <div class="modal-header bg-neutral-50 py-12 px-24 border-bottom">
        <h5 class="modal-title">Выберите работу или услугу</h5>
      </div>
      <div class="modal-body p-24">
        <div class="mb-16">
          <input type="text" class="form-control" id="search-product-modal" placeholder="Поиск по названию...">
        </div>
        <div id="products-modal-list">
          <div class="text-center py-24 text-secondary-light">
            <iconify-icon icon="mdi:loading" class="spin text-2xl"></iconify-icon>
            <p class="mt-8">Загрузка услуг...</p>
          </div>
        </div>
        <div id="no-products-message" style="display: none;" class="text-center py-24">
          <iconify-icon icon="mdi:package-variant" class="text-secondary-light text-4xl"></iconify-icon>
          <p class="mt-8 text-secondary-light">Услуги не найдены</p>
          <a href="/dashboard/products" class="btn btn-sm btn-primary-600 mt-8">Добавить услугу</a>
        </div>
      </div>
      <div class="modal-footer">
        <a href="/dashboard/products" class="btn btn-outline-primary-600">
          <iconify-icon icon="mdi:plus"></iconify-icon>
          В справочник
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Auth Required Modal -->
<div class="modal fade" id="authRequiredModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content radius-16">
      <div class="modal-header bg-primary-50 py-16 px-24 border-bottom">
        <h5 class="modal-title">Документ сохранен</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-24 text-center">
        <div class="mb-24">
          <span class="w-80-px h-80-px bg-success-100 rounded-circle d-flex justify-content-center align-items-center mx-auto mb-16">
            <iconify-icon icon="mdi:check-circle" class="text-success-600 text-4xl"></iconify-icon>
          </span>
          <h5 class="fw-semibold mb-8">Ваш Акт сохранен</h5>
          <p class="text-secondary-light mb-0">
            Для скачивания документа необходимо войти в аккаунт или зарегистрироваться.<br>
            <strong>Ваш документ уже ждет вас в личном кабинете!</strong>
          </p>
        </div>
        <div class="d-flex flex-column gap-12">
          <a href="/login" class="btn btn-primary-600 radius-8 px-24 py-12">
            Войти в аккаунт
          </a>
          <a href="/register" class="btn btn-outline-primary-600 radius-8 px-24 py-12">
            Зарегистрироваться
          </a>
        </div>
        <p class="text-sm text-secondary-light mt-16 mb-0">
          После входа вы сможете скачать документ в любом формате
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Guest Registration Modal (Documatica v12.0 Style) -->
<div class="modal fade" id="guestRegistrationModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content" style="border: none; border-radius: 3rem; overflow: hidden; box-shadow: 0 50px 100px -20px rgba(15,23,42,0.3);">
      <div class="modal-body p-0">
        <div class="row g-0">
          <!-- Left Side - Branding -->
          <div class="col-md-5" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); position: relative; overflow: hidden;">
            <div class="pattern-light" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.15;"></div>
            <div class="p-48 position-relative" style="z-index: 1;">
              <div class="mb-48">
                <svg viewBox="0 0 64 64" width="48" height="48" class="mb-24">
                  <path d="M12 16H48V48H12V16Z" fill="#3b82f6" fill-opacity="0.2"/>
                  <path d="M18 24H46M18 32H46M18 40H34" stroke="#3b82f6" stroke-width="6" stroke-linecap="round"/>
                  <circle cx="48" cy="40" r="6" fill="#FBBF24"/>
                </svg>
                <h2 class="text-white mb-12" style="font-size: 2rem; font-weight: 900; text-transform: uppercase; line-height: 1.1;">
                  Создайте аккаунт
                </h2>
                <p class="text-secondary-light" style="font-size: 1rem; color: #94a3b8 !important;">
                  Зарегистрируйтесь, чтобы скачать ваш документ и получить доступ ко всем возможностям
                </p>
              </div>
              
              <div class="d-flex flex-column gap-16">
                <div class="d-flex align-items-start gap-12">
                  <svg width="20" height="20" style="min-width: 20px; margin-top: 2px;">
                    <circle cx="10" cy="10" r="8" fill="#3b82f6" fill-opacity="0.2"/>
                    <path d="M6 10L9 13L14 7" stroke="#3b82f6" stroke-width="2" fill="none"/>
                  </svg>
                  <span class="text-white" style="font-size: 0.875rem;">5 бесплатных документов в месяц</span>
                </div>
                <div class="d-flex align-items-start gap-12">
                  <svg width="20" height="20" style="min-width: 20px; margin-top: 2px;">
                    <circle cx="10" cy="10" r="8" fill="#3b82f6" fill-opacity="0.2"/>
                    <path d="M6 10L9 13L14 7" stroke="#3b82f6" stroke-width="2" fill="none"/>
                  </svg>
                  <span class="text-white" style="font-size: 0.875rem;">Автосохранение документов</span>
                </div>
                <div class="d-flex align-items-start gap-12">
                  <svg width="20" height="20" style="min-width: 20px; margin-top: 2px;">
                    <circle cx="10" cy="10" r="8" fill="#3b82f6" fill-opacity="0.2"/>
                    <path d="M6 10L9 13L14 7" stroke="#3b82f6" stroke-width="2" fill="none"/>
                  </svg>
                  <span class="text-white" style="font-size: 0.875rem;">Справочники организаций и услуг</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Right Side - Form -->
          <div class="col-md-7">
            <div class="p-48">
              <div class="text-end mb-24">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
              </div>
              
              <div id="guest-reg-alert" class="alert alert-danger d-none mb-24" role="alert" style="border-radius: 1rem;"></div>
              
              <form id="guest-registration-form">
                <div class="mb-24">
                  <label class="form-label mb-8" style="font-size: 9px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.1em; color: #64748b;">
                    Email
                  </label>
                  <input type="email" class="form-control" id="guest-email" name="email" required
                    style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 1rem 1.5rem; font-weight: 600; font-size: 0.875rem;"
                    placeholder="ivan@example.com">
                </div>
                
                <div class="mb-24">
                  <label class="form-label mb-8" style="font-size: 9px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.1em; color: #64748b;">
                    Пароль
                  </label>
                  <input type="password" class="form-control" id="guest-password" name="password" required
                    style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 1rem 1.5rem; font-weight: 600; font-size: 0.875rem;"
                    placeholder="Минимум 6 символов">
                  <small class="text-secondary-light mt-4 d-block" style="font-size: 0.75rem;">Минимум 6 символов</small>
                </div>
                
                <div class="mb-24">
                  <label class="form-label mb-8" style="font-size: 9px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.1em; color: #64748b;">
                    Имя (необязательно)
                  </label>
                  <input type="text" class="form-control" id="guest-name" name="name"
                    style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 1rem 1.5rem; font-weight: 600; font-size: 0.875rem;"
                    placeholder="Иван Иванов">
                </div>
                
                <div class="mb-32">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="guest-terms" required
                      style="width: 1.25rem; height: 1.25rem; border-radius: 0.375rem; border: 2px solid #cbd5e1;">
                    <label class="form-check-label ms-8" for="guest-terms" style="font-size: 0.75rem; color: #64748b;">
                      Я принимаю <a href="/terms" target="_blank" class="text-primary-600">условия использования</a> и <a href="/privacy" target="_blank" class="text-primary-600">политику конфиденциальности</a>
                    </label>
                  </div>
                </div>
                
                <button type="submit" class="btn w-100 mb-16" id="guest-reg-submit-btn"
                  style="background: #3b82f6; color: white; border: none; border-radius: 1.5rem; padding: 1rem 1.5rem; font-weight: 900; font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; transition: all 0.3s;">
                  Зарегистрироваться
                </button>
                
                <div class="text-center">
                  <p class="text-secondary-light mb-0" style="font-size: 0.875rem;">
                    Уже есть аккаунт? <a href="/login" class="text-primary-600 fw-semibold">Войти</a>
                  </p>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- jQuery library js -->
<script src="/static/js/lib/jquery-3.7.1.min.js"></script>
<!-- Bootstrap js -->
<script src="/static/js/lib/bootstrap.bundle.min.js"></script>
<!-- Iconify Font js -->
<script src="/static/js/lib/iconify-icon.min.js"></script>
<!-- Date picker js -->
<script src="/static/js/flatpickr.js"></script>
<!-- jQuery UI js -->
<script src="/static/js/lib/jquery-ui.min.js"></script>
<!-- main js -->
<script src="/static/js/app.js"></script>

<!-- Pass Jinja2 variables to JavaScript -->
<script>
    window.AKT_CONFIG = {
        editDocumentId: '{{ edit_document_id | default("") }}',
        apiUrl: '/api/v1'
    };
</script>

<!-- Akt Constructor Main JS -->
<script src="/static/js/akt-constructor.js?v=1.1"></script>

<!-- Support Widget -->
{% include 'components/support_widget.html' %}

</body>
</html>
