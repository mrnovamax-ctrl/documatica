{#
  FORM MACROS v12.0
  Jinja2 макросы для конструкторов документов
  
  Использование:
  {% from 'dashboard/macros/form_macros.html' import form_card, form_input, form_select, etc. %}
#}

{# ============================================
   FORM CARD - Карточка секции формы
   ============================================ #}
{% macro form_card(section_number='', section_title='', compact=true, margin_bottom='24px') %}
<div class="form-card-v12 {% if compact %}form-card-compact{% endif %}" style="{% if margin_bottom %}margin-bottom: {{ margin_bottom }};{% endif %}">
  {% if section_number or section_title %}
  <div class="form-section-header-v12">{% if section_number %}{{ section_number }}. {% endif %}{{ section_title }}</div>
  {% endif %}
  {{ caller() }}
</div>
{% endmacro %}


{# ============================================
   FORM ROW - Ряд полей с сеткой
   ============================================ #}
{% macro form_row(cols=1, gap='20px') %}
<div class="form-row-v12 cols-{{ cols }}" style="{% if gap != '20px' %}gap: {{ gap }};{% endif %}">
  {{ caller() }}
</div>
{% endmacro %}


{# ============================================
   FORM GROUP - Контейнер для поля
   ============================================ #}
{% macro form_group(style='') %}
<div class="form-group-v12" {% if style %}style="{{ style }}"{% endif %}>
  {{ caller() }}
</div>
{% endmacro %}


{# ============================================
   FORM INPUT - Текстовое поле
   ============================================ #}
{% macro form_input(id, label, placeholder='', type='text', required=false, maxlength='', value='', class_extra='', readonly=false) %}
<div class="form-group-v12">
  <label class="form-label-v12" for="{{ id }}">{{ label }}{% if required %} *{% endif %}</label>
  <input 
    type="{{ type }}" 
    class="form-input-v12 {{ class_extra }}" 
    id="{{ id }}" 
    name="{{ id }}"
    placeholder="{{ placeholder }}"
    {% if required %}required{% endif %}
    {% if maxlength %}maxlength="{{ maxlength }}"{% endif %}
    {% if value %}value="{{ value }}"{% endif %}
    {% if readonly %}readonly{% endif %}
  >
</div>
{% endmacro %}


{# ============================================
   FORM INPUT WITH BUTTON - Поле с кнопкой
   ============================================ #}
{% macro form_input_with_btn(id, label, placeholder='', btn_id='', btn_icon='search', required=false, maxlength='', btn_title='') %}
<div class="form-group-v12">
  <label class="form-label-v12" for="{{ id }}">{{ label }}{% if required %} *{% endif %}</label>
  <div class="input-with-btn-v12">
    <input 
      type="text" 
      class="form-input-v12" 
      id="{{ id }}" 
      name="{{ id }}"
      placeholder="{{ placeholder }}"
      {% if required %}required{% endif %}
      {% if maxlength %}maxlength="{{ maxlength }}"{% endif %}
    >
    <button type="button" class="input-btn" {% if btn_id %}id="{{ btn_id }}"{% endif %} {% if btn_title %}title="{{ btn_title }}"{% endif %}>
      {% if btn_icon == 'search' %}
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      {% elif btn_icon == 'auto' %}
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/><path d="M9 12l2 2 4-4"/></svg>
      {% elif btn_icon == 'refresh' %}
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 11-2.636-6.364"/><path d="M21 3v6h-6"/></svg>
      {% elif btn_icon == 'calendar' %}
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
      {% else %}
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      {% endif %}
    </button>
  </div>
</div>
{% endmacro %}


{# ============================================
   FORM SELECT - Выпадающий список
   ============================================ #}
{% macro form_select(id, label, options, selected='', required=false) %}
<div class="form-group-v12">
  <label class="form-label-v12" for="{{ id }}">{{ label }}{% if required %} *{% endif %}</label>
  <select class="form-select-v12" id="{{ id }}" name="{{ id }}" {% if required %}required{% endif %}>
    {% for opt in options %}
      {% if opt is mapping %}
        <option value="{{ opt.value }}" {% if opt.value|string == selected|string %}selected{% endif %}>{{ opt.label }}</option>
      {% else %}
        <option value="{{ opt }}" {% if opt|string == selected|string %}selected{% endif %}>{{ opt }}</option>
      {% endif %}
    {% endfor %}
  </select>
</div>
{% endmacro %}


{# ============================================
   FORM TEXTAREA - Многострочное поле
   ============================================ #}
{% macro form_textarea(id, label, placeholder='', rows=4, required=false) %}
<div class="form-group-v12">
  <label class="form-label-v12" for="{{ id }}">{{ label }}{% if required %} *{% endif %}</label>
  <textarea 
    class="form-textarea-v12" 
    id="{{ id }}" 
    name="{{ id }}"
    placeholder="{{ placeholder }}"
    rows="{{ rows }}"
    {% if required %}required{% endif %}
  ></textarea>
</div>
{% endmacro %}


{# ============================================
   FORM DATE - Поле даты
   ============================================ #}
{% macro form_date(id, label, placeholder='ДД.ММ.ГГГГ', required=false) %}
<div class="form-group-v12">
  <label class="form-label-v12" for="{{ id }}">{{ label }}{% if required %} *{% endif %}</label>
  <input 
    type="text" 
    class="form-input-v12 date-picker" 
    id="{{ id }}" 
    name="{{ id }}"
    placeholder="{{ placeholder }}"
    {% if required %}required{% endif %}
  >
</div>
{% endmacro %}


{# ============================================
   FORM NUMBER - Числовое поле
   ============================================ #}
{% macro form_number(id, label, value='', min='', max='', step='0.01', required=false, class_extra='') %}
<div class="form-group-v12">
  <label class="form-label-v12" for="{{ id }}">{{ label }}{% if required %} *{% endif %}</label>
  <input 
    type="number" 
    class="form-input-v12 {{ class_extra }}" 
    id="{{ id }}" 
    name="{{ id }}"
    value="{{ value }}"
    {% if min != '' %}min="{{ min }}"{% endif %}
    {% if max != '' %}max="{{ max }}"{% endif %}
    step="{{ step }}"
    {% if required %}required{% endif %}
  >
</div>
{% endmacro %}


{# ============================================
   FORM RADIO GROUP - Группа радио-кнопок
   ============================================ #}
{% macro form_radio_group(name, options, selected='', label='') %}
{% if label %}
<label class="form-label-v12" style="margin-bottom: 16px;">{{ label }}</label>
{% endif %}
<div class="form-radio-group-v12">
  {% for opt in options %}
  <label class="form-radio-v12">
    <input type="radio" name="{{ name }}" value="{{ opt.value }}" {% if opt.value|string == selected|string %}checked{% endif %}>
    <span class="radio-circle"></span>
    <span class="radio-label">{{ opt.label }}</span>
  </label>
  {% endfor %}
</div>
{% endmacro %}


{# ============================================
   FORM CHECKBOX - Чекбокс
   ============================================ #}
{% macro form_checkbox(id, title, description='', checked=false) %}
<label class="form-checkbox-v12">
  <input type="checkbox" id="{{ id }}" name="{{ id }}" {% if checked %}checked{% endif %}>
  <span class="checkbox-box">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="20 6 9 17 4 12"/></svg>
  </span>
  <span class="checkbox-content">
    <span class="checkbox-title">{{ title }}</span>
    {% if description %}
    <span class="checkbox-desc">{{ description }}</span>
    {% endif %}
  </span>
</label>
{% endmacro %}


{# ============================================
   FORM DIVIDER - Разделитель секции
   ============================================ #}
{% macro form_divider(margin='24px') %}
<div style="padding-top: {{ margin }}; margin-top: {{ margin }}; border-top: 1px solid #e2e8f0;"></div>
{% endmacro %}


{# ============================================
   PRODUCTS TABLE - Таблица товаров/услуг
   ============================================ #}
{% macro products_container(id='products-container') %}
<div id="{{ id }}">
  {{ caller() }}
</div>
{% endmacro %}


{# ============================================
   PRODUCT ROW - Строка товара
   ============================================ #}
{% macro product_row(row_num=1, units=['шт', 'усл', 'ч', 'кг', 'л', 'м', 'м2', 'м3']) %}
<div class="product-row-v12" data-row="{{ row_num }}">
  <div class="product-grid">
    <div class="form-group-v12">
      <label class="form-label-v12">Наименование *</label>
      <input type="text" class="form-input-v12 product-name" placeholder="Название товара или услуги" required>
    </div>
    <div class="form-group-v12">
      <label class="form-label-v12">Кол-во</label>
      <input type="number" class="form-input-v12 product-qty" value="1" min="0.01" step="0.01">
    </div>
    <div class="form-group-v12">
      <label class="form-label-v12">Ед. изм.</label>
      <select class="form-select-v12 product-unit">
        {% for unit in units %}
        <option value="{{ unit }}">{{ unit }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-group-v12">
      <label class="form-label-v12">Цена</label>
      <input type="number" class="form-input-v12 product-price" value="0" min="0" step="0.01">
    </div>
    <div class="form-group-v12" style="align-self: end;">
      <button type="button" class="remove-btn remove-product" title="Удалить">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
      </button>
    </div>
  </div>
</div>
{% endmacro %}


{# ============================================
   ADD PRODUCT BUTTON - Кнопка добавить позицию
   ============================================ #}
{% macro add_product_btn(id='add-product', text='Добавить позицию') %}
<button type="button" class="add-product-v12" id="{{ id }}">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg>
  {{ text }}
</button>
{% endmacro %}


{# ============================================
   FORM TOTALS - Блок итогов
   ============================================ #}
{% macro form_totals(show_vat=true) %}
<div class="form-totals-v12">
  {% if show_vat %}
  <div class="total-row">
    <span class="total-label">Итого без НДС:</span>
    <span class="total-value" id="total-without-vat">0 руб.</span>
  </div>
  <div class="total-row">
    <span class="total-label">НДС:</span>
    <span class="total-value" id="total-vat">0 руб.</span>
  </div>
  {% endif %}
  <div class="total-row grand">
    <span class="total-label">{% if show_vat %}Итого с НДС:{% else %}Итого к оплате:{% endif %}</span>
    <span class="total-value" id="total-with-vat">0 руб.</span>
  </div>
</div>
{% endmacro %}


{# ============================================
   FORM ACTIONS - Кнопки действий
   ============================================ #}
{% macro form_actions(primary_text='Скачать PDF', show_draft=true, show_template=true, show_preview=true) %}
<div class="form-card-v12 form-card-compact">
  <div class="form-footer-v12" style="border-top: none; padding-top: 0; margin-top: 0;">
    <div class="form-actions-v12" style="width: 100%; justify-content: center;">
      {% if show_draft %}
      <button type="button" class="form-btn-secondary-v12" id="save-draft">Сохранить черновик</button>
      {% endif %}
      {% if show_template %}
      <button type="button" class="form-btn-secondary-v12" id="save-template">Сохранить как шаблон</button>
      {% endif %}
      {% if show_preview %}
      <button type="button" class="form-btn-secondary-v12" id="preview-btn">Предпросмотр</button>
      {% endif %}
      <button type="submit" class="form-btn-primary-v12">
        {{ primary_text }}
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
      </button>
    </div>
  </div>
</div>
{% endmacro %}
