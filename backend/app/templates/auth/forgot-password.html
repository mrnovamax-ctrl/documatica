{% extends "base.html" %}

{% block title %}Восстановление пароля — Documatica{% endblock %}

{% block body_class %}auth-page{% endblock %}

{% block body %}
<div class="auth-page-v12">
  <div class="auth-card-v12">
    <!-- Header -->
    <div class="auth-header-v12">
      <a href="/" class="auth-logo-v12">
        <svg viewBox="0 0 64 64">
          <path d="M12 16H48V48H12V16Z" fill="#3b82f6" fill-opacity="0.1"/>
          <path d="M18 24H46M18 32H46M18 40H34" stroke="#3b82f6" stroke-width="6" stroke-linecap="round"/>
          <circle cx="48" cy="40" r="6" fill="#FBBF24"/>
        </svg>
        <span class="logo-text">
          <span class="logo-bold">docu</span><span class="logo-light">matica</span>
        </span>
      </a>
      <h1 class="auth-title-v12">Восстановление пароля</h1>
      <p class="auth-subtitle-v12">Введите email, на который зарегистрирован аккаунт</p>
    </div>
    
    <!-- Success Message (hidden by default) -->
    <div id="success-message" class="auth-message-v12 success" style="display: none;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <div>
        <strong>Письмо отправлено!</strong>
        <p>Проверьте почту и следуйте инструкциям для сброса пароля.</p>
      </div>
    </div>
    
    <!-- Form -->
    <form id="forgot-form" class="auth-form-v12">
      <div class="auth-field-v12">
        <label class="auth-label-v12">Email</label>
        <input type="email" class="auth-input-v12" name="email" required placeholder="email@company.com">
      </div>
      
      <button type="submit" class="auth-btn-v12">
        Отправить ссылку
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="5" y1="12" x2="19" y2="12"></line>
          <polyline points="12 5 19 12 12 19"></polyline>
        </svg>
      </button>
    </form>
    
    <!-- Footer -->
    <div class="auth-footer-v12">
      <p>Вспомнили пароль? <a href="/login/">Войти</a></p>
    </div>
    
    <!-- System Status -->
    <div class="auth-status-v12">
      <div class="status-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
        </svg>
      </div>
      <span class="status-text">Secure Connection</span>
    </div>
  </div>
</div>

<script>
document.getElementById('forgot-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const form = e.target;
  const btn = form.querySelector('button[type="submit"]');
  const email = form.querySelector('input[name="email"]').value;
  
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Отправка...';
  
  try {
    const response = await fetch('/api/v1/auth/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    });
    
    const data = await response.json();
    
    if (response.ok) {
      // Показываем сообщение об успехе
      form.style.display = 'none';
      document.getElementById('success-message').style.display = 'flex';
    } else {
      toastError(data.detail || 'Ошибка при отправке');
      btn.disabled = false;
      btn.innerHTML = 'Отправить ссылку <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>';
    }
  } catch (error) {
    toastError('Ошибка соединения');
    btn.disabled = false;
    btn.innerHTML = 'Отправить ссылку <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>';
  }
});
</script>

<style>
.auth-message-v12 {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  padding: 1.5rem;
  border-radius: 1rem;
  margin-bottom: 1.5rem;
}
.auth-message-v12.success {
  background: rgba(34, 197, 94, 0.1);
  border: 1px solid rgba(34, 197, 94, 0.2);
  color: #16a34a;
}
.auth-message-v12 svg {
  flex-shrink: 0;
  margin-top: 2px;
}
.auth-message-v12 strong {
  display: block;
  margin-bottom: 0.25rem;
}
.auth-message-v12 p {
  margin: 0;
  font-size: 0.875rem;
  opacity: 0.9;
}
.spinner {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
{% endblock %}
