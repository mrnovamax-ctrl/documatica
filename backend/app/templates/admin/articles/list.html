{% extends "admin/base_admin.html" %}

{% block title %}Статьи{% endblock %}
{% block page_title %}Статьи{% endblock %}

{% block header_actions %}
<a href="/admin/articles/create/" class="admin-btn-primary">
  <iconify-icon icon="ri:add-line" width="18"></iconify-icon>
  Новая статья
</a>
{% endblock %}

{% block content %}
<!-- Stats -->
<div class="admin-stats-row" style="display: flex; gap: 24px; margin-bottom: 32px;">
  <div class="admin-stat-mini">
    <span class="admin-stat-mini-value">{{ total }}</span>
    <span class="admin-stat-mini-label">Всего статей</span>
  </div>
  <div class="admin-stat-mini">
    <span class="admin-stat-mini-value" style="color: #22c55e;">{{ articles | selectattr('is_published') | list | length }}</span>
    <span class="admin-stat-mini-label">Опубликовано</span>
  </div>
  <div class="admin-stat-mini">
    <span class="admin-stat-mini-value" style="color: #f59e0b;">{{ articles | rejectattr('is_published') | list | length }}</span>
    <span class="admin-stat-mini-label">Черновики</span>
  </div>
</div>

<!-- Articles Table -->
<div class="admin-table-container">
  <!-- Table Header -->
  <div class="admin-table-header" style="display: grid; grid-template-columns: 3fr 1fr 1fr 1fr 100px; padding: 16px 28px;">
    <div class="admin-table-th">Статья</div>
    <div class="admin-table-th">Категория</div>
    <div class="admin-table-th">Просмотры</div>
    <div class="admin-table-th">Дата</div>
    <div class="admin-table-th">Статус</div>
  </div>
  
  <!-- Table Body -->
  {% for article in articles %}
  <a href="/admin/articles/{{ article.id }}/" class="admin-table-row" style="display: grid; grid-template-columns: 3fr 1fr 1fr 1fr 100px; padding: 20px 28px; text-decoration: none; border-bottom: 1px solid #f8fafc; transition: background 0.2s;" onmouseover="this.style.background='#fafbfc'" onmouseout="this.style.background='white'">
    <!-- Title -->
    <div>
      <div style="font-weight: 700; color: #0f172a; margin-bottom: 4px;">{{ article.title[:60] }}{% if article.title|length > 60 %}...{% endif %}</div>
      <div style="font-size: 12px; color: #94a3b8;">/news/{{ article.slug }}/</div>
    </div>
    
    <!-- Category -->
    <div>
      {% set cat_name = article.category | upper %}
      {% for cat in categories if cat.slug == article.category %}
        {% set cat_name = cat.name %}
      {% endfor %}
      <span class="admin-badge admin-badge-muted">{{ cat_name }}</span>
    </div>
    
    <!-- Views -->
    <div style="font-weight: 600; color: #64748b;">
      {{ article.views | default(0) }}
    </div>
    
    <!-- Date -->
    <div style="font-size: 13px; color: #64748b;">
      {{ article.created_at[:10] if article.created_at else 'N/A' }}
    </div>
    
    <!-- Status -->
    <div>
      {% if article.is_published %}
      <span class="admin-badge admin-badge-success">
        <iconify-icon icon="ri:checkbox-circle-fill" width="12"></iconify-icon>
        Опубл.
      </span>
      {% else %}
      <span class="admin-badge admin-badge-warning">
        <iconify-icon icon="ri:draft-line" width="12"></iconify-icon>
        Черновик
      </span>
      {% endif %}
    </div>
  </a>
  {% else %}
  <div class="admin-empty-state">
    <iconify-icon icon="ri:article-line" width="64"></iconify-icon>
    <div class="admin-empty-state-title">Статьи не найдены</div>
    <div class="admin-empty-state-text">Создайте первую статью</div>
    <a href="/admin/articles/create/" class="admin-btn-primary" style="margin-top: 24px;">
      <iconify-icon icon="ri:add-line" width="18"></iconify-icon>
      Создать статью
    </a>
  </div>
  {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="admin-pagination">
  {% if page > 1 %}
  <a href="?page={{ page - 1 }}" class="admin-pagination-btn">
    <iconify-icon icon="ri:arrow-left-s-line" width="20"></iconify-icon>
  </a>
  {% endif %}
  
  {% for p in range(1, total_pages + 1) %}
  <a href="?page={{ p }}" class="admin-pagination-btn {% if p == page %}active{% endif %}">
    {{ p }}
  </a>
  {% endfor %}
  
  {% if page < total_pages %}
  <a href="?page={{ page + 1 }}" class="admin-pagination-btn">
    <iconify-icon icon="ri:arrow-right-s-line" width="20"></iconify-icon>
  </a>
  {% endif %}
</div>
{% endif %}

<style>
.admin-stat-mini {
  background: white;
  border: 1px solid #f1f5f9;
  border-radius: 1rem;
  padding: 16px 24px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.admin-stat-mini-value {
  font-size: 24px;
  font-weight: 800;
  color: #0f172a;
}
.admin-stat-mini-label {
  font-size: 13px;
  color: #64748b;
}
</style>
{% endblock %}
