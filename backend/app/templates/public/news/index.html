{% extends "base_public.html" %}

{% block title %}{{ title }} - Documatica{% endblock %}
{% block meta_description %}{{ description }}{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="knowledge-hub-section pattern-light" style="padding-bottom: 40px;">
  <div class="container">
    <!-- Breadcrumbs -->
    <nav class="news-breadcrumbs" style="margin-bottom: 24px;">
      <ol class="news-breadcrumbs__list">
        {% for crumb in breadcrumbs if crumb %}
        <li class="news-breadcrumbs__item">
          {% if not loop.first %}
          <span class="news-breadcrumbs__separator">/</span>
          {% endif %}
          {% if crumb.url %}
          <a href="{{ crumb.url }}" class="news-breadcrumbs__link">{{ crumb.title }}</a>
          {% else %}
          <span class="news-breadcrumbs__current">{{ crumb.title }}</span>
          {% endif %}
        </li>
        {% endfor %}
      </ol>
    </nav>
    
    <div class="knowledge-hub-header">
      <div class="knowledge-hub-label">
        <span class="ai-node"></span>
        <span>База знаний // Knowledge Hub</span>
      </div>
      <h1 class="knowledge-hub-title">
        {{ title.split()[0] if title else 'Статьи' }} <br><span class="accent">{{ ' '.join(title.split()[1:]) if title and title.split()|length > 1 else 'и руководства' }}</span>
      </h1>
    </div>
  </div>
</section>

<!-- Categories Filter -->
<section class="news-filter" style="background: var(--docu-base);">
  <div class="container">
    <div class="news-filter__list" style="justify-content: center; gap: 12px; flex-wrap: wrap;">
      <a href="/news/" class="article-card-tag{% if not current_category %} article-card-tag--blue{% endif %}" style="padding: 10px 20px; font-size: 12px; text-decoration: none;">
        Все статьи
      </a>
      {% for cat in categories %}
      <a href="/news/?category={{ cat.slug }}" class="article-card-tag{% if current_category and current_category.slug == cat.slug %} article-card-tag--blue{% endif %}" style="padding: 10px 20px; font-size: 12px; text-decoration: none;">
        {{ cat.name }}
      </a>
      {% endfor %}
    </div>
  </div>
</section>

<!-- Articles Grid -->
<section class="knowledge-hub-section" style="padding-top: 48px; background: #f8fafc;">
  <div class="container">
    {% if articles %}
    
    <!-- Первая статья - Featured -->
    {% if articles[0] %}
    <div class="knowledge-hub-grid" style="margin-bottom: 32px;">
      <a href="/news/{{ articles[0].slug }}/" class="article-card article-card--featured">
        <div class="article-card-bg-blob"></div>
        <div class="article-card-header">
          <span class="article-card-badge article-card-badge--primary">Featured</span>
          <div class="article-card-arrow">
            <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
          </div>
        </div>
        <div class="article-card-content">
          {% set cat = None %}
          {% for c in categories if c.slug == articles[0].category %}
            {% set cat = c %}
          {% endfor %}
          <span class="article-card-category">{{ cat.name if cat else articles[0].category | default("Статьи") }}</span>
          <h3 class="article-card-title article-card-title--large">{{ articles[0].title }}</h3>
          <p class="article-card-excerpt">{{ articles[0].excerpt[:200] }}{% if articles[0].excerpt|length > 200 %}...{% endif %}</p>
        </div>
      </a>

      <!-- Боковые статьи (2-3) -->
      {% if articles|length > 1 %}
      <div class="article-card-side-grid">
        {% for article in articles[1:3] %}
        <a href="/news/{{ article.slug }}/" class="article-card article-card--small">
          <div class="article-card-header">
            {% set cat = None %}
            {% for c in categories if c.slug == article.category %}
              {% set cat = c %}
            {% endfor %}
            <span class="article-card-tag{% if loop.index == 1 %} article-card-tag--blue{% else %} article-card-tag--amber{% endif %}">{{ cat.name if cat else article.category | default("Статьи") }}</span>
            <div class="article-card-arrow article-card-arrow--small">
              <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
            </div>
          </div>
          <div class="article-card-content">
            <h4 class="article-card-title article-card-title--small">{{ article.title | truncate(60) }}</h4>
            <p class="article-card-meta">{{ article.created_at[:10] if article.created_at else '' }}</p>
          </div>
        </a>
        {% endfor %}
      </div>
      {% endif %}
    </div>
    {% endif %}

    <!-- Остальные статьи (4+) -->
    {% if articles|length > 3 %}
    <div class="knowledge-hub-bottom-row" style="margin-bottom: 32px;">
      {% for article in articles[3:] %}
      <a href="/news/{{ article.slug }}/" class="article-card article-card--small">
        <div class="article-card-header">
          {% set cat = None %}
          {% for c in categories if c.slug == article.category %}
            {% set cat = c %}
          {% endfor %}
          <span class="article-card-tag{% if loop.index % 3 == 0 %} article-card-tag--blue{% elif loop.index % 3 == 1 %} article-card-tag--amber{% endif %}">{{ cat.name if cat else article.category | default("Статьи") }}</span>
          <div class="article-card-arrow article-card-arrow--small">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
          </div>
        </div>
        <div class="article-card-content">
          <h4 class="article-card-title article-card-title--small">{{ article.title | truncate(50) }}</h4>
          <p class="article-card-meta">{{ article.created_at[:10] if article.created_at else '' }}</p>
        </div>
      </a>
      {% endfor %}
    </div>
    {% endif %}
    
    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="news-pagination" style="display: flex; justify-content: center; gap: 8px; margin-top: 48px;">
      {% if page > 1 %}
      <a href="?{% if current_category %}category={{ current_category.slug }}&{% endif %}page={{ page - 1 }}" class="article-card-tag" style="padding: 12px 16px; text-decoration: none;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
      </a>
      {% endif %}
      
      {% for p in range(1, total_pages + 1) %}
      <a href="?{% if current_category %}category={{ current_category.slug }}&{% endif %}page={{ p }}" class="article-card-tag{% if p == page %} article-card-tag--blue{% endif %}" style="padding: 12px 20px; text-decoration: none; font-weight: 700;">
        {{ p }}
      </a>
      {% endfor %}
      
      {% if page < total_pages %}
      <a href="?{% if current_category %}category={{ current_category.slug }}&{% endif %}page={{ page + 1 }}" class="article-card-tag" style="padding: 12px 16px; text-decoration: none;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
      </a>
      {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <!-- Empty State -->
    <div class="knowledge-hub-empty" style="text-align: center; padding: 80px 0;">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="1.5" style="margin-bottom: 24px;">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
      </svg>
      <h3 style="font-size: 24px; font-weight: 800; color: var(--docu-ink); margin-bottom: 8px;">Статьи не найдены</h3>
      <p style="color: var(--docu-body);">В этой категории пока нет статей</p>
    </div>
    {% endif %}
  </div>
</section>

<!-- CTA Section -->
<section class="cta-section-v12" style="background: #f8fafc;">
  <div class="container">
    <div class="cta-card-v12">
      <div class="cta-content-v12">
        <div class="cta-label-v12">
          <span class="ai-node"></span>
          Начните сейчас
        </div>
        <h2 class="cta-title-v12">Готовы <span class="accent">автоматизировать?</span></h2>
        <p class="cta-subtitle-v12">Создайте первый УПД за 2 минуты. Бесплатно.</p>
        <a href="/dashboard/upd/create/" class="cta-btn-v12">Создать документ</a>
      </div>
    </div>
  </div>
</section>
{% endblock %}
