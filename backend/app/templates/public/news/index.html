{% extends "base_public.html" %}

{% block title %}{{ title }} - Documatica{% endblock %}
{% block meta_description %}{{ description }}{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="news-hero">
  <div class="container">
    <!-- Breadcrumbs -->
    <nav class="news-breadcrumbs">
      <ol class="news-breadcrumbs__list">
        {% for crumb in breadcrumbs if crumb %}
        <li class="news-breadcrumbs__item">
          {% if not loop.first %}
          <span class="news-breadcrumbs__separator">/</span>
          {% endif %}
          {% if crumb.url %}
          <a href="{{ crumb.url }}" class="news-breadcrumbs__link">{{ crumb.title }}</a>
          {% else %}
          <span class="news-breadcrumbs__current">{{ crumb.title }}</span>
          {% endif %}
        </li>
        {% endfor %}
      </ol>
    </nav>
    
    <h1 class="news-hero__title">{{ title }}</h1>
    <p class="news-hero__desc">{{ description }}</p>
  </div>
</section>

<!-- Categories Filter -->
<section class="news-filter">
  <div class="container">
    <div class="news-filter__list">
      <a href="/news/" class="news-filter__btn{% if not current_category %} news-filter__btn--active{% endif %}">
        Все статьи
      </a>
      {% for cat in categories %}
      <a href="/news/?category={{ cat.slug }}" class="news-filter__btn{% if current_category and current_category.slug == cat.slug %} news-filter__btn--active{% endif %}">
        {{ cat.name }}
      </a>
      {% endfor %}
    </div>
  </div>
</section>

<!-- Articles Grid -->
<section class="news-grid-section">
  <div class="container">
    {% if articles %}
    <div class="news-grid">
      {% for article in articles %}
      <article class="news-card">
        <!-- Image -->
        <a href="/news/{{ article.slug }}/" class="news-card__image">
          {% if article.image %}
          <img src="{{ article.image }}" alt="{{ article.title }}">
          {% else %}
          <div class="news-card__placeholder">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="1.5">
              <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/>
              <path d="M8.5 10a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
              <path d="m21 15-5-5L5 21"/>
            </svg>
          </div>
          {% endif %}
        </a>
        
        <!-- Content -->
        <div class="news-card__body">
          <!-- Category & Date -->
          <div class="news-card__meta">
            {% set cat = None %}
            {% for c in categories if c.slug == article.category %}
              {% set cat = c %}
            {% endfor %}
            {% if cat %}
            <span class="news-card__category">{{ cat.name }}</span>
            {% endif %}
            <span class="news-card__date">{{ article.created_at[:10] }}</span>
          </div>
          
          <!-- Title -->
          <h2 class="news-card__title">
            <a href="/news/{{ article.slug }}/">{{ article.title }}</a>
          </h2>
          
          <!-- Excerpt -->
          <p class="news-card__excerpt">
            {{ article.excerpt[:150] }}{% if article.excerpt|length > 150 %}...{% endif %}
          </p>
          
          <!-- Read More -->
          <a href="/news/{{ article.slug }}/" class="news-card__link">
            Читать далее
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </a>
        </div>
      </article>
      {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="news-pagination">
      {% if page > 1 %}
      <a href="?{% if current_category %}category={{ current_category.slug }}&{% endif %}page={{ page - 1 }}" class="news-pagination__btn news-pagination__btn--arrow">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
      </a>
      {% endif %}
      
      {% for p in range(1, total_pages + 1) %}
      <a href="?{% if current_category %}category={{ current_category.slug }}&{% endif %}page={{ p }}" class="news-pagination__btn{% if p == page %} news-pagination__btn--active{% endif %}">
        {{ p }}
      </a>
      {% endfor %}
      
      {% if page < total_pages %}
      <a href="?{% if current_category %}category={{ current_category.slug }}&{% endif %}page={{ page + 1 }}" class="news-pagination__btn news-pagination__btn--arrow">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
      </a>
      {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <!-- Empty State -->
    <div class="news-empty">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="1.5">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
      </svg>
      <h3>Статьи не найдены</h3>
      <p>В этой категории пока нет статей</p>
    </div>
    {% endif %}
  </div>
</section>

<!-- CTA Section -->
<section class="news-cta">
  <div class="container">
    <div class="news-cta__card">
      <h2 class="news-cta__title">Создайте документ прямо сейчас</h2>
      <p class="news-cta__desc">УПД, счета, акты — за 2 минуты с автозаполнением по ИНН</p>
      <a href="/dashboard/upd/create/" class="news-cta__btn">
        Попробовать бесплатно
      </a>
    </div>
  </div>
</section>
{% endblock %}
